<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of trackOptiView</title>
  <meta name="keywords" content="trackOptiView">
  <meta name="description" content="trackOptiView provides visulization of the segmented data.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">SuperSeggerRelease</a> &gt; <a href="index.html">viz</a> &gt; trackOptiView.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for SuperSeggerRelease/viz&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>trackOptiView
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>trackOptiView provides visulization of the segmented data.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function trackOptiView(dirname,file_filter,err_flag) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> trackOptiView provides visulization of the segmented data.

 It has a lot of options such as :
 f : Toggle between phase and fluorescence view
 x# :  Switch xy dir #
 t  : Show Cell Numbers
 r  : Show/Hide Region Outlines
 o  : Show Consensus
 K  : Kymograph Mosaic
 h# : Tower for Cell #
 g  : Make Gate
 Clear : Clear all Gates
 c  : Reset Plot to Default View'
 s  : Show Fluor Foci
 #  : Go to Frame Number #
 CC : Use Complete Cell Cycles
 F : Find Cell Number #
 p  : Show/Hide Cell Poles
 H# : Show Kymograph for Cell #
 Z  : Cell Towers Mosaic
 G  : Gate All Cell Files
 Movie : Export Movie Frames

 INPUT :
       dirname : directory that contains file segemented by supeSegger
       file_filter : used to obtain the contents (deafult .err file)
       err_flag : if 1, displays errors found in frame, default 0

 Copyright (C) 2016 Wiggins Lab
 University of Washington, 2016
 This file is part of SuperSeggerOpti.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="makeConsIm.html" class="code" title="function [ imMosaic, imColor, imBW, imInv, kymo, kymoMask, I,kymoMax, kymoMaskMax, imMosaic10, imBWunmasked, imBWmask, hotPix,AA, BB ] = makeConsIm( dirName, CONST, skip, mag, disp_flag )">makeConsIm</a>	makeConsIm : Computes consensus fluorescence localization from cells in a cell files</li><li><a href="makeFrameMosaic.html" class="code" title="function [im] = makeFrameMosaic( data, CONST, xdim, disp_flag, skip )">makeFrameMosaic</a>	makeFrameMosaic: Creates a tower for a single cell.</li><li><a href="makeFrameStripeMosaic.html" class="code" title="function [imTot] = makeFrameStripeMosaic( dirName, CONST, skip, disp_flag )">makeFrameStripeMosaic</a>	makeFrameStripeMosaic :  Creates a cell tower for all the cells in</li><li><a href="makeKymoMosaic.html" class="code" title="function makeKymoMosaic (dirname, CONST)">makeKymoMosaic</a>	makeKymoMosaic creates a mosaic kymograph of multiple cells.</li><li><a href="makeKymographC.html" class="code" title="function [Kymo,ll1,f1mm,f2mm] = makeKymographC( data, disp_flag, CONST );">makeKymographC</a>	makeKymographC creates a kymograph for given cell.</li><li><a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>	showDA4new : produces the trackOptiView image according to clist and</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function data = loaderInternal( filename, clist )</a></li><li><a href="#_sub2" class="code">function [nameInfo] = getDirStruct( dirname )</a></li><li><a href="#_sub3" class="code">function padStr = getPadSize( dirname )</a></li><li><a href="#_sub4" class="code">function ixy = intGetNum( str_xy )</a></li><li><a href="#_sub5" class="code">function [data_r, data_c, data_f] = intLoadData( dirname,</a></li><li><a href="#_sub6" class="code">function val = AD_FLAG()</a></li><li><a href="#_sub7" class="code">function val = SD_FLAG()</a></li><li><a href="#_sub8" class="code">function val = ND_FLAG()</a></li><li><a href="#_sub9" class="code">function intDispError( data_c, FLAGS )</a></li><li><a href="#_sub10" class="code">function FLAGS = intSetDefaultFlags()</a></li><li><a href="#_sub11" class="code">function intCons(dirname0, contents_xy, dircons, setHeader, CONST)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function trackOptiView(dirname,file_filter,err_flag)</a>
0002 <span class="comment">% trackOptiView provides visulization of the segmented data.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% It has a lot of options such as :</span>
0005 <span class="comment">% f : Toggle between phase and fluorescence view</span>
0006 <span class="comment">% x# :  Switch xy dir #</span>
0007 <span class="comment">% t  : Show Cell Numbers</span>
0008 <span class="comment">% r  : Show/Hide Region Outlines</span>
0009 <span class="comment">% o  : Show Consensus</span>
0010 <span class="comment">% K  : Kymograph Mosaic</span>
0011 <span class="comment">% h# : Tower for Cell #</span>
0012 <span class="comment">% g  : Make Gate</span>
0013 <span class="comment">% Clear : Clear all Gates</span>
0014 <span class="comment">% c  : Reset Plot to Default View'</span>
0015 <span class="comment">% s  : Show Fluor Foci</span>
0016 <span class="comment">% #  : Go to Frame Number #</span>
0017 <span class="comment">% CC : Use Complete Cell Cycles</span>
0018 <span class="comment">% F : Find Cell Number #</span>
0019 <span class="comment">% p  : Show/Hide Cell Poles</span>
0020 <span class="comment">% H# : Show Kymograph for Cell #</span>
0021 <span class="comment">% Z  : Cell Towers Mosaic</span>
0022 <span class="comment">% G  : Gate All Cell Files</span>
0023 <span class="comment">% Movie : Export Movie Frames</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% INPUT :</span>
0026 <span class="comment">%       dirname : directory that contains file segemented by supeSegger</span>
0027 <span class="comment">%       file_filter : used to obtain the contents (deafult .err file)</span>
0028 <span class="comment">%       err_flag : if 1, displays errors found in frame, default 0</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% Copyright (C) 2016 Wiggins Lab</span>
0031 <span class="comment">% University of Washington, 2016</span>
0032 <span class="comment">% This file is part of SuperSeggerOpti.</span>
0033 
0034 <span class="comment">%% Load Constants and Initialize Flags</span>
0035 
0036 hf = figure(1);
0037 clf;
0038 <span class="comment">%set( hf, 'Color', [0.1,0.1,0.1] );</span>
0039 
0040 mov = struct;
0041 CONST = [];
0042 touch_list = [];
0043 
0044 
0045 <span class="keyword">if</span> nargin&lt;2 || isempty(file_filter);
0046     file_filter = <span class="string">'*err.mat'</span>;
0047 <span class="keyword">end</span>
0048 
0049 <span class="keyword">if</span> nargin&lt;3 || isempty(err_flag);
0050     err_flag = 0;
0051 <span class="keyword">end</span>
0052 
0053 FLAGS.err_flag = err_flag;
0054 
0055 
0056 <span class="keyword">if</span> ~exist(<span class="string">'strip_flag'</span>);
0057     strip_flag = 1;
0058 <span class="keyword">end</span>
0059 
0060 <span class="comment">% Add slash to the file name if it doesn't exist</span>
0061 <span class="keyword">if</span>(nargin&lt;1 || isempty(dirname))
0062     
0063     dirname=uigetdir()
0064     dirname=[dirname,filesep];
0065 <span class="keyword">else</span>
0066     <span class="keyword">if</span> dirname(end)~=filesep
0067         dirname=[dirname,filesep];
0068     <span class="keyword">end</span>
0069 <span class="keyword">end</span>
0070 
0071 D_FLAG = [];
0072 
0073 n_char    = numel(dirname);
0074 seg_pos   = strfind( dirname, [<span class="string">'seg'</span>,filesep]);
0075 
0076 <span class="keyword">if</span> (n_char - seg_pos) == (numel([<span class="string">'seg'</span>,filesep])-1)
0077     disp( <span class="string">'seg mode'</span> );
0078     D_FLAG = <a href="#_sub7" class="code" title="subfunction val = SD_FLAG()">SD_FLAG</a>;
0079 <span class="keyword">else</span>
0080     <span class="keyword">if</span> exist( [dirname,filesep,<span class="string">'raw_im'</span>],<span class="string">'dir'</span>)
0081         D_FLAG = <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>;
0082     <span class="keyword">else</span>
0083         D_FLAG = <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>;
0084     <span class="keyword">end</span>
0085 <span class="keyword">end</span>
0086 
0087 dirname0 = dirname;
0088 
0089 
0090 <span class="comment">% load flags if they already exist to maintain state between launches</span>
0091 filename_flags = [dirname0,<span class="string">'.trackOptiView.mat'</span>];
0092 <span class="keyword">if</span>  (D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>) &amp;&amp; exist( filename_flags, <span class="string">'file'</span> )
0093     load(filename_flags);
0094 <span class="keyword">else</span>
0095     FLAGS = <a href="#_sub10" class="code" title="subfunction FLAGS = intSetDefaultFlags()">intSetDefaultFlags</a>();
0096     
0097     error_list = [];
0098     nn = 1;
0099     dirnum = 1;
0100 <span class="keyword">end</span>
0101 
0102 contents = [];
0103 
0104 <span class="comment">% Load info from one of the xy directories. dirnum tells you which one. If</span>
0105 <span class="comment">% you quit the program in an xy dir, it goes to that xy dir.</span>
0106 clist = [];
0107 <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0108     contents_xy =dir([dirname, <span class="string">'xy*'</span>]);
0109     
0110     <span class="comment">% Load up the aska set name from the file header.mat</span>
0111     setHeaderFileName = [dirname,<span class="string">'header.mat'</span>];
0112     <span class="keyword">if</span> exist( setHeaderFileName, <span class="string">'file'</span> );
0113         setHeader = load( setHeaderFileName );
0114         setHeader = setHeader.header;
0115     <span class="keyword">else</span>
0116         setHeader = [];
0117     <span class="keyword">end</span>
0118     
0119     <span class="keyword">try</span>
0120         dircons = [dirname0,<span class="string">'consensus'</span>,filesep];
0121         mkdir( dircons );
0122     <span class="keyword">end</span>
0123     
0124     num_xy = numel(contents_xy);
0125     <span class="keyword">if</span> ~num_xy
0126         disp(<span class="string">'no xy dirs'</span>);
0127         <span class="keyword">return</span>;
0128     <span class="keyword">else</span>
0129         <span class="keyword">if</span> isdir([dirname0,contents_xy(dirnum).name,filesep,<span class="string">'seg_full'</span>])
0130             dirname = [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'seg_full'</span>,filesep];
0131         <span class="keyword">else</span>
0132             dirname = [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'seg'</span>,filesep];
0133         <span class="keyword">end</span>
0134         
0135         dirname_cell = [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'cell'</span>,filesep];
0136         dirname_xy = [dirname0,contents_xy(dirnum).name,filesep];
0137         
0138         <span class="comment">% Open clist if it exists</span>
0139         clist_name = [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'clist.mat'</span>];
0140         <span class="keyword">if</span> exist( clist_name, <span class="string">'file'</span> )
0141             clist = load([dirname0,contents_xy(dirnum).name,filesep,<span class="string">'clist.mat'</span>]);
0142         <span class="keyword">else</span>
0143             clist = [];
0144         <span class="keyword">end</span>
0145         
0146         ixy = <a href="#_sub4" class="code" title="subfunction ixy = intGetNum( str_xy )">intGetNum</a>( contents_xy(dirnum).name );
0147         header = [<span class="string">'xy'</span>,num2str(ixy),<span class="string">': '</span>];
0148         
0149     <span class="keyword">end</span>
0150     nameInfo = [];
0151 <span class="keyword">elseif</span> D_FLAG == <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>
0152     [nameInfo] = <a href="#_sub2" class="code" title="subfunction [nameInfo] = getDirStruct( dirname )">getDirStruct</a>( dirname0 );
0153     num_xy = numel(nameInfo.nxy);
0154     header = [<span class="string">'xy'</span>,num2str(dirnum),<span class="string">': '</span>];
0155     
0156 <span class="keyword">end</span>
0157 
0158 
0159 FLAGS.D_flag  = D_FLAG;
0160 
0161 <span class="keyword">if</span> (D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>) || (D_FLAG == <a href="#_sub7" class="code" title="subfunction val = SD_FLAG()">SD_FLAG</a>)
0162     contents=dir([dirname, file_filter]);
0163     num_im = length(contents);
0164 <span class="keyword">else</span>
0165     num_im = numel(nameInfo.nt);
0166 <span class="keyword">end</span>
0167 
0168 
0169 <span class="keyword">try</span>
0170     CONST = load([dirname0,<span class="string">'CONST.mat'</span>]);
0171     <span class="keyword">if</span> isfield( CONST, <span class="string">'CONST'</span> )
0172         CONST = CONST.CONST;
0173     <span class="keyword">end</span>
0174 <span class="keyword">catch</span>
0175     disp([<span class="string">'Exiting. Can''t load CONST file. Make sure there is a CONST.mat file at the root'</span>, <span class="keyword">...</span>
0176         <span class="string">'level of the data directory.'</span>]);
0177     <span class="keyword">return</span>
0178 <span class="keyword">end</span>
0179 
0180 <span class="keyword">if</span> nn &gt; num_im
0181     nn = num_im;
0182 <span class="keyword">end</span>
0183 
0184 
0185 runFlag = (nn&lt;=num_im);
0186 first_flag = 1;
0187 
0188 <span class="comment">% This flag controls whether you reload from file</span>
0189 resetFlag = true;
0190 FLAGS.e_flag = 0 ;
0191 
0192 <span class="comment">%% Run the main loop... and run it while the runFlag is true.</span>
0193 <span class="keyword">while</span> runFlag
0194     
0195     <span class="comment">% load current frame</span>
0196     <span class="keyword">if</span> resetFlag
0197         resetFlag = false;
0198         [data_r, data_c, data_f] = <a href="#_sub5" class="code" title="subfunction [data_r, data_c, data_f] = intLoadData( dirname, ">intLoadData</a>( dirname, <span class="keyword">...</span>
0199             D_FLAG, contents, nn, num_im, nameInfo, clist, dirnum);
0200     <span class="keyword">end</span>
0201     
0202     <span class="keyword">if</span> ~first_flag
0203         tmp_axis = axis;
0204     <span class="keyword">else</span>
0205         <span class="keyword">try</span>
0206             imshow( data_c.phase );
0207         <span class="keyword">end</span>
0208         
0209     <span class="keyword">end</span>
0210 
0211     <a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>( data_c, data_r, data_f, FLAGS, clist, CONST);
0212 
0213     
0214     <span class="keyword">if</span> FLAGS.c_flag &amp;&amp; ~first_flag
0215         axis( tmp_axis );
0216     <span class="keyword">end</span>
0217     first_flag = false;
0218     
0219     
0220     
0221     <span class="comment">% Main Menu</span>
0222     disp(<span class="string">'-----------------------------------------------------------'</span>);
0223     disp(<span class="string">'SuperSegger Data Viewer'</span>);
0224     disp(<span class="string">' '</span>);
0225     disp(<span class="string">'q  : To quit                    c  : Reset Plot to Default View'</span>);
0226     disp(<span class="string">'f  : Toggle Phase/Fluor         s  : Show Fluor Foci           '</span>);
0227     disp(<span class="string">'x# : Switch xy dir #            #  : Go to Frame Number #      '</span>);
0228     disp(<span class="string">'t  : Show Cell Numbers          CC : Use Complete Cell Cycles '</span>);
0229     disp(<span class="string">'r  : Show/Hide Region Outlines  F# : Find Cell Number #       '</span>);
0230     disp(<span class="string">'o  : Show Consensus             p  : Show/Hide Cell Poles      '</span>);
0231     disp(<span class="string">'K  : Kymograph Mosaic           H# : Show Kymograph for Cell #'</span>);
0232     disp(<span class="string">'h# : Tower for Cell #           Z  : Cell Towers Mosaic        '</span>);
0233     disp(<span class="string">'g  : Make Gate                  G  : Gate All Cell Files       '</span>);
0234     disp(<span class="string">'Clear : Clear all Gates         Movie : Export Movie Frames   '</span>);
0235     disp(<span class="string">' '</span>);
0236     disp(<span class="string">'              k : Enter debugging mode                      '</span>);
0237     disp(<span class="string">'-----------------------------------------------------------'</span>)
0238     disp(<span class="string">' '</span>);
0239     
0240     <span class="comment">% if you loaded segmented data</span>
0241     <span class="keyword">if</span> D_FLAG ~= <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>
0242         <span class="comment">% show the master error list.</span>
0243         <span class="keyword">if</span> FLAGS.err_flag
0244             <span class="keyword">if</span> isempty(error_list)
0245                 error_list = trackOptiGetErrorListDisk( dirname, [] );
0246             <span class="keyword">end</span>
0247             disp(error_list);
0248         <span class="keyword">end</span>
0249         <span class="comment">% show errors in this frame.</span>
0250         <span class="keyword">if</span> FLAGS.e_flag
0251             <a href="#_sub9" class="code" title="subfunction intDispError( data_c, FLAGS )">intDispError</a>( data_c, FLAGS );
0252         <span class="keyword">end</span>
0253     <span class="keyword">end</span>
0254     
0255     <span class="keyword">if</span> ~isempty( touch_list );
0256         disp(<span class="string">'Warning! Frames touched. Run re-link.'</span>);
0257         touch_list
0258     <span class="keyword">end</span>
0259     
0260     
0261     disp([header, <span class="string">'Frame num [1...'</span>,num2str(num_im),<span class="string">']: '</span>,num2str(nn)]);
0262     
0263     c = input(<span class="string">':'</span>,<span class="string">'s'</span>)
0264     
0265     <span class="comment">% LIST OF COMMANDS</span>
0266     <span class="keyword">if</span> isempty(c)
0267         <span class="comment">% do nothing</span>
0268     
0269     <span class="keyword">elseif</span> c(1) == <span class="string">'q'</span> <span class="comment">% Quit Command</span>
0270         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0271             <span class="keyword">try</span>
0272                 save( [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'clist.mat'</span>],<span class="string">'-STRUCT'</span>,<span class="string">'clist'</span>);
0273             <span class="keyword">catch</span>
0274                 disp(<span class="string">'Error saving clist file.'</span>);
0275             <span class="keyword">end</span>
0276         <span class="keyword">end</span>
0277         runFlag = 0  ;
0278                 
0279     <span class="keyword">elseif</span> strcmp(c,<span class="string">'CC'</span>) <span class="comment">% Toggle Between Full Cell Cycles</span>
0280         CONST.view.showFullCellCycleOnly = ~CONST.view.showFullCellCycleOnly ;
0281         <span class="keyword">if</span> CONST.view.showFullCellCycleOnly
0282             disp(<span class="string">'Only including complete Cell Cycles (press any key)'</span>)
0283             pause
0284         <span class="keyword">else</span>
0285             disp(<span class="string">'Including Incomplete Cell Cycles (press any key)'</span>)
0286             pause
0287         <span class="keyword">end</span>
0288            
0289     <span class="keyword">elseif</span> c(1) == <span class="string">'F'</span> <span class="comment">% Find Single Cells</span>
0290         <span class="keyword">if</span> numel(c) &gt; 1
0291             find_num = floor(str2num(c(2:end)));
0292             <span class="keyword">if</span> FLAGS.v_flag
0293                 regnum = find( data_c.regs.ID == find_num);
0294                 
0295                 <span class="keyword">if</span> ~isempty( regnum )
0296                     plot(data_c.CellA{regnum}.coord.r_center(1),<span class="keyword">...</span>
0297                         data_c.CellA{regnum}.coord.r_center(2), <span class="keyword">...</span>
0298                         <span class="string">'yx'</span>,<span class="string">'MarkerSize'</span>,100);
0299                 <span class="keyword">else</span>
0300                     disp(<span class="string">'coundt fidn that cell'</span>);
0301                 <span class="keyword">end</span>
0302                 
0303             <span class="keyword">else</span>
0304                 <span class="keyword">if</span> (find_num &lt;= data_c.regs.num_regs) &amp;&amp; (find_num &gt;0)
0305                     plot(data_c.CellA{find_num}.coord.r_center(1),<span class="keyword">...</span>
0306                         data_c.CellA{find_num}.coord.r_center(2), <span class="keyword">...</span>
0307                         <span class="string">'yx'</span>,<span class="string">'MarkerSize'</span>,100);
0308                 <span class="keyword">else</span>
0309                     disp( <span class="string">'Out of range'</span> );
0310                 <span class="keyword">end</span>
0311             <span class="keyword">end</span>
0312             
0313             input(<span class="string">'Press any key'</span>,<span class="string">'s'</span>);
0314             
0315         <span class="keyword">end</span>
0316                 
0317     <span class="keyword">elseif</span> c(1) == <span class="string">'x'</span> <span class="comment">% Change xy positions</span>
0318         <span class="keyword">if</span> D_FLAG ~= <a href="#_sub7" class="code" title="subfunction val = SD_FLAG()">SD_FLAG</a>
0319             
0320             <span class="keyword">if</span> numel(c)&gt;1
0321                 c = c(2:end);
0322             <span class="keyword">else</span>
0323                 <span class="keyword">for</span> ll = 1:num_xy
0324                     <span class="keyword">if</span> D_FLAG ~= <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>
0325                         disp( [num2str(ll),<span class="string">': '</span>,contents_xy(ll).name] );
0326                     <span class="keyword">else</span>
0327                         disp( [num2str(ll),<span class="string">': xy'</span>,num2str(nameInfo.nxy(ll))] );
0328                     <span class="keyword">end</span>
0329                 <span class="keyword">end</span>
0330                 c = input(<span class="string">':'</span>,<span class="string">'s'</span>)
0331             <span class="keyword">end</span>
0332             ll_ = floor(str2num(c));
0333             
0334             <span class="keyword">if</span> ~isempty(ll_) &amp;&amp; (ll_&gt;=1) &amp;&amp; (ll_&lt;=num_xy)
0335                 <span class="keyword">if</span> D_FLAG ~= <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>
0336                     
0337                     
0338                     <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0339                         <span class="keyword">try</span>
0340                             save( [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'clist.mat'</span>],<span class="string">'-STRUCT'</span>,<span class="string">'clist'</span>);
0341                         <span class="keyword">catch</span>
0342                             disp( <span class="string">'Error writing clist file.'</span>);
0343                         <span class="keyword">end</span>
0344                     <span class="keyword">end</span>
0345                     
0346                     dirnum = ll_;
0347                     
0348                     <span class="keyword">if</span> isdir([dirname0,contents_xy(dirnum).name,filesep,<span class="string">'seg_full'</span>])
0349                         dirname = [dirname0,contents_xy(ll_).name,filesep,<span class="string">'seg_full'</span>,filesep];
0350                     <span class="keyword">else</span>
0351                         dirname = [dirname0,contents_xy(ll_).name,filesep,<span class="string">'seg'</span>,filesep];
0352                     <span class="keyword">end</span>
0353                     
0354                     dirname_cell = [dirname0,contents_xy(ll_).name,filesep,<span class="string">'cell'</span>,filesep];
0355                     dirname_xy = [dirname0,contents_xy(ll_).name,filesep];
0356                     
0357                     ixy = <a href="#_sub4" class="code" title="subfunction ixy = intGetNum( str_xy )">intGetNum</a>( contents_xy(dirnum).name );
0358                     header = [<span class="string">'xy'</span>,num2str(ixy),<span class="string">': '</span>];
0359                     
0360                     contents=dir([dirname, file_filter]);
0361                     error_list = [];
0362                     
0363                     
0364                     clist = load([dirname0,contents_xy(ll_).name,filesep,<span class="string">'clist.mat'</span>]);
0365                 <span class="keyword">else</span>
0366                     dirnum = nameInfo.nxy(ll_);
0367                     header = [<span class="string">'xy'</span>,num2str(dirnum),<span class="string">': '</span>];
0368                     
0369                 <span class="keyword">end</span>
0370             <span class="keyword">end</span>
0371             resetFlag = true;
0372         <span class="keyword">else</span>
0373             disp( <span class="string">'Not supported in this mode.'</span> );
0374         <span class="keyword">end</span>
0375         
0376         
0377     <span class="keyword">elseif</span> c(1) == <span class="string">'r'</span> <span class="comment">% Show/Hide Region Outlines</span>
0378         FLAGS.P_flag = ~FLAGS.P_flag;
0379                
0380     <span class="keyword">elseif</span> strcmp(c,<span class="string">'c'</span>) <span class="comment">% Reset Plot to Default View</span>
0381         FLAGS.c_flag = ~FLAGS.c_flag;
0382         clf;
0383         first_flag = 1;
0384                
0385     <span class="keyword">elseif</span> c(1) == <span class="string">'f'</span>  <span class="comment">% Toggle Between Fluorescence and Phase Images</span>
0386         FLAGS.f_flag = ~FLAGS.f_flag;
0387               
0388     <span class="keyword">elseif</span> c(1) == <span class="string">'g'</span> <span class="comment">% choose characteristics and values to gate cells</span>
0389         disp(<span class="string">'Choose gating characteristic'</span>)
0390         disp(clist.def')
0391         cc = input(<span class="string">'Gate Number(s) [ ] :'</span>,<span class="string">'s'</span>) ;
0392         tmp_clist = gateMake(clist,str2num(cc)) ;
0393         
0394         clist = tmp_clist ;
0395         clf;
0396         first_flag = 1;
0397               
0398     <span class="keyword">elseif</span> strcmp(c,<span class="string">'Clear'</span>)  <span class="comment">% Clear All Gates</span>
0399         clist.gate = [] ;
0400         clf;
0401         first_flag = 1;
0402               
0403     <span class="keyword">elseif</span> c(1) == <span class="string">'G'</span>   <span class="comment">% moves gated cell Files to a different directory</span>
0404         header = <span class="string">'trackOptiView: '</span>;       
0405         trackOptiGateCellFiles(dirname,dirname_cell,CONST, header, clist);
0406             
0407     <span class="keyword">elseif</span> c(1) == <span class="string">'C'</span> <span class="comment">% Gate All XY Positions</span>
0408         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0409                        
0410             <span class="keyword">if</span> ~isfield( clist, <span class="string">'gate'</span> );
0411                 clist.gate = [];
0412             <span class="keyword">end</span>
0413             
0414             <span class="keyword">for</span> ll_ = 1:num_xy
0415                 filename = [dirname0,contents_xy(ll_).name,filesep,<span class="string">'clist.mat'</span>];
0416                 
0417                 clist_tmp = gate(load( filename ));
0418                 <span class="keyword">if</span>  ll_ == 1
0419                     clist_comp =clist_tmp;
0420                 <span class="keyword">else</span>
0421                     clist_comp.data = [clist_comp.data; clist_tmp.data];
0422                 <span class="keyword">end</span>
0423             <span class="keyword">end</span>
0424             
0425             save( [dirname0,<span class="string">'clist_comp.mat'</span>], <span class="string">'-STRUCT'</span>, <span class="string">'clist_comp'</span> );
0426             
0427         <span class="keyword">else</span>
0428             disp(<span class="string">'Not supported'</span>);
0429         <span class="keyword">end</span>
0430                        
0431     <span class="keyword">elseif</span> c(1) == <span class="string">'t'</span> <span class="comment">% Show Cell Numbers</span>
0432         FLAGS.t_flag = ~FLAGS.t_flag;
0433                 
0434     <span class="keyword">elseif</span> c(1) == <span class="string">'s'</span> <span class="comment">% Show Fluorescent Foci Fits</span>
0435         FLAGS.s_flag = ~FLAGS.s_flag;
0436                
0437     <span class="keyword">elseif</span> c(1) == <span class="string">'p'</span>  <span class="comment">% Show Cell Poles</span>
0438         FLAGS.p_flag = ~FLAGS.p_flag;
0439                 
0440     <span class="keyword">elseif</span> c(1) == <span class="string">'k'</span> <span class="comment">% Enter Debugging Mode</span>
0441         tmp_axis = axis;
0442         disp(<span class="string">'Type &quot;return&quot; to exit debugging mode'</span>)
0443         keyboard
0444         resetFlag = true;
0445         clf;
0446         axis( tmp_axis );
0447         
0448         
0449     <span class="keyword">elseif</span> c(1) == <span class="string">'K'</span> <span class="comment">% Make Kymograph Mosaic for All Cells</span>
0450         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0451             tmp_axis = axis;
0452             clf;
0453             <a href="makeKymoMosaic.html" class="code" title="function makeKymoMosaic (dirname, CONST)">makeKymoMosaic</a>( dirname_cell, CONST );           
0454             disp(<span class="string">'press enter to continue.'</span>);
0455             pause;
0456             axis(tmp_axis);
0457         <span class="keyword">else</span>
0458             disp( <span class="string">'Not supported in this mode.'</span> );
0459         <span class="keyword">end</span>
0460         
0461     <span class="keyword">elseif</span> c(1) == <span class="string">'Z'</span> <span class="comment">%  Show Cell Towers for All Cells</span>
0462         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0463             tmp_axis = axis;
0464             clf;
0465                        
0466             <span class="keyword">if</span> numel(c) &gt; 1
0467                 ll_ = floor(str2num(c(2:end)));
0468             <span class="keyword">else</span>
0469                 ll_ = [];
0470             <span class="keyword">end</span>
0471             
0472             <a href="makeFrameStripeMosaic.html" class="code" title="function [imTot] = makeFrameStripeMosaic( dirName, CONST, skip, disp_flag )">makeFrameStripeMosaic</a>( [dirname_cell], CONST, ll_,true );
0473             axis equal
0474             
0475             disp(<span class="string">'press enter to continue.'</span>);
0476             pause;
0477             axis(tmp_axis);
0478         <span class="keyword">else</span>
0479             disp( <span class="string">'Not supported in this mode.'</span> );
0480         <span class="keyword">end</span>
0481         
0482         
0483     <span class="keyword">elseif</span> c(1) == <span class="string">'o'</span> <span class="comment">% Show existant consensus for this XY or calculate new one</span>
0484         <a href="#_sub11" class="code" title="subfunction intCons(dirname0, contents_xy, dircons, setHeader, CONST)">intCons</a>(dirname0, contents_xy(ixy), dircons, setHeader, CONST)<span class="comment">%</span>
0485                 
0486     <span class="keyword">elseif</span> c(1) == <span class="string">'Y'</span> <span class="comment">% Calculate Consensus for all XY</span>
0487         
0488         tmp_axis = axis;
0489         clf;     
0490         
0491         parfor iii = 1:num_xy                       
0492             <span class="keyword">try</span>
0493                 <a href="#_sub11" class="code" title="subfunction intCons(dirname0, contents_xy, dircons, setHeader, CONST)">intCons</a>(dirname0, contents_xy(iii), dircons, setHeader, CONST)
0494             <span class="keyword">catch</span>
0495                 disp( [<span class="string">'Failed on: '</span>, contents_xy(iii).name] );
0496             <span class="keyword">end</span>
0497             
0498         <span class="keyword">end</span>
0499         
0500         
0501         FLAGS__.v_flag = 1;
0502         FLAGS__.m_flag = 0;
0503         FLAGS__.t_flag = 1;
0504         FLAGS__.T_flag = 0;
0505         FLAGS__.ID_flag = 1;
0506         FLAGS__.P_flag = 1;
0507         FLAGS__.e_flag = 0;
0508         FLAGS__.f_flag = 1;
0509         FLAGS__.s_flag = 1;
0510         FLAGS__.p_flag = 0;
0511         FLAGS__.c_flag = 1;
0512         FLAGS__.lyse_flag = 0;
0513         FLAGS__.err_flag = 0;
0514         FLAGS__.D_flag = 0;
0515         
0516         <span class="keyword">for</span> iii = 1:num_xy
0517             
0518             <span class="keyword">try</span>
0519                 iii
0520                 nn__ = 10;
0521                 
0522                 <span class="keyword">if</span> isdir([dirname0,contents_xy(iii).name,filesep,<span class="string">'seg_full'</span>])
0523                     dirname__ = [dirname0,contents_xy(iii).name,filesep,<span class="string">'seg_full'</span>,filesep];
0524                 <span class="keyword">else</span>
0525                     dirname__ = [dirname0,contents_xy(iii).name,filesep,<span class="string">'seg'</span>,filesep];
0526                 <span class="keyword">end</span>
0527                 
0528                 dirname_cell__ = [dirname0,contents_xy(iii).name,filesep,<span class="string">'cell'</span>,filesep];
0529                 dirname_xy__ = [dirname0,contents_xy(iii).name,filesep];
0530                 
0531                 ixy__ = <a href="#_sub4" class="code" title="subfunction ixy = intGetNum( str_xy )">intGetNum</a>( contents_xy(iii).name );
0532                 header__ = [<span class="string">'xy'</span>,num2str(ixy),<span class="string">': '</span>];
0533                 
0534                 contents__=dir([dirname__, file_filter]);
0535                 error_list = [];
0536                 
0537                 clist__ = load([dirname0,contents_xy(iii).name,filesep,<span class="string">'clist.mat'</span>]);
0538                 nameInfo__ = <a href="#_sub2" class="code" title="subfunction [nameInfo] = getDirStruct( dirname )">getDirStruct</a>( dirname0 );
0539                 
0540                 [data_r__, data_c__, data_f__] = <a href="#_sub5" class="code" title="subfunction [data_r, data_c, data_f] = intLoadData( dirname, ">intLoadData</a>( dirname__, <span class="keyword">...</span>
0541                     D_FLAG, contents__, nn__, num_im, nameInfo__, clist__, iii);
0542                             
0543                 im_tmp = <a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>( data_c__, data_r__, data_f__, FLAGS__, clist__, CONST);
0544                 imwrite( im_tmp, [dircons, <span class="string">'field_'</span>, setHeader, <span class="string">'_'</span>, num2str(ixy__,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
0545             <span class="keyword">catch</span> ME
0546                 printError(ME);
0547                 disp([<span class="string">'error with '</span>,num2str(iii)]);
0548             <span class="keyword">end</span>
0549         <span class="keyword">end</span>
0550         
0551         figure(1);       
0552         axis equal
0553                
0554         figure(1);
0555         axis(tmp_axis);
0556         
0557         
0558     <span class="keyword">elseif</span> c(1) == <span class="string">'h'</span> <span class="comment">% Cell Tower for Single Cell</span>
0559         
0560         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0561             
0562             <span class="keyword">if</span> numel(c) &gt; 1
0563                 comma_pos = findstr(c,<span class="string">','</span>);
0564                 
0565                 <span class="keyword">if</span> isempty(comma_pos)
0566                     ll_ = floor(str2num(c(2:end)));
0567                     xdim__ = [];
0568                 <span class="keyword">else</span>
0569                     ll_ = floor(str2num(c(2:comma_pos(1))));
0570                     xdim__ = floor(str2num(c(comma_pos(1):end)));
0571                 <span class="keyword">end</span>
0572                 
0573                 padStr = <a href="#_sub3" class="code" title="subfunction padStr = getPadSize( dirname )">getPadSize</a>( dirname_cell );
0574                 
0575                 <span class="keyword">if</span> ~isempty( padStr )
0576                     data_cell = [];
0577                     filename_cell_C = [dirname_cell,<span class="string">'Cell'</span>,num2str(ll_,padStr),<span class="string">'.mat'</span>]
0578                     filename_cell_c = [dirname_cell,<span class="string">'cell'</span>,num2str(ll_,padStr),<span class="string">'.mat'</span>]
0579                     
0580                     <span class="keyword">if</span> exist(filename_cell_C, <span class="string">'file'</span> )
0581                         filename_cell = filename_cell_C;
0582                     <span class="keyword">elseif</span> exist(filename_cell_c, <span class="string">'file'</span> )
0583                         filename_cell = filename_cell_c;
0584                     <span class="keyword">else</span>
0585                         filename_cell = [];
0586                     <span class="keyword">end</span>
0587                     
0588                     <span class="keyword">if</span> isempty( filename_cell )
0589                         disp( [<span class="string">'Files: '</span>,filename_cell_C,<span class="string">' and '</span>,filename_cell_c,<span class="string">' do not exist.'</span>]);
0590                     <span class="keyword">else</span>
0591                         <span class="keyword">try</span>
0592                             data_cell = load( filename_cell );
0593                         <span class="keyword">catch</span>
0594                             disp([<span class="string">'Error loading: '</span>, filename_cell] );
0595                         <span class="keyword">end</span>
0596                         
0597                         <span class="keyword">if</span> ~isempty( data_cell )
0598                             tmp_axis = axis;
0599                             clf;
0600                             im_tmp = <a href="makeFrameMosaic.html" class="code" title="function [im] = makeFrameMosaic( data, CONST, xdim, disp_flag, skip )">makeFrameMosaic</a>(data_cell, CONST, xdim__);
0601                             disp(<span class="string">'Press enter to continue'</span>);
0602                             pause;
0603                             axis(tmp_axis);
0604                         <span class="keyword">end</span>
0605                         
0606                     <span class="keyword">end</span>
0607                 <span class="keyword">end</span>
0608             <span class="keyword">end</span>
0609         <span class="keyword">else</span>
0610             disp( <span class="string">'Not supported in this mode.'</span> );
0611         <span class="keyword">end</span>
0612         
0613         
0614     <span class="keyword">elseif</span> c(1) == <span class="string">'H'</span> <span class="comment">% Show Kymograph for Single Cell</span>
0615         
0616         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0617             
0618             <span class="keyword">if</span> numel(c) &gt; 1
0619                 ll_ = floor(str2num(c(2:end)));
0620                 
0621                 padStr = <a href="#_sub3" class="code" title="subfunction padStr = getPadSize( dirname )">getPadSize</a>( dirname_cell );
0622                 
0623                 <span class="keyword">if</span> ~isempty( padStr )
0624                     data_cell = [];
0625                     filename_cell_C = [dirname_cell,<span class="string">'Cell'</span>,num2str(ll_,padStr),<span class="string">'.mat'</span>]
0626                     filename_cell_c = [dirname_cell,<span class="string">'cell'</span>,num2str(ll_,padStr),<span class="string">'.mat'</span>]
0627                     
0628                     <span class="keyword">if</span> exist(filename_cell_C, <span class="string">'file'</span> )
0629                         filename_cell = filename_cell_C;
0630                     <span class="keyword">elseif</span> exist(filename_cell_c, <span class="string">'file'</span> )
0631                         filename_cell = filename_cell_c;
0632                     <span class="keyword">else</span>
0633                         filename_cell = [];
0634                     <span class="keyword">end</span>
0635                     
0636                     <span class="keyword">if</span> isempty( filename_cell )
0637                         disp( [<span class="string">'Files: '</span>,filename_cell_C,<span class="string">' and '</span>,filename_cell_c,<span class="string">' do not exist.'</span>]);
0638                     <span class="keyword">else</span>
0639                         <span class="keyword">try</span>
0640                             data_cell = load( filename_cell );
0641                         <span class="keyword">catch</span>
0642                             disp([<span class="string">'Error loading: '</span>, filename_cell] );
0643                         <span class="keyword">end</span>
0644                         
0645                         <span class="keyword">if</span> ~isempty( data_cell )
0646                             tmp_axis = axis;
0647                             clf;
0648                             <a href="makeKymographC.html" class="code" title="function [Kymo,ll1,f1mm,f2mm] = makeKymographC( data, disp_flag, CONST );">makeKymographC</a>(data_cell, 1, CONST );
0649                             ylabel(<span class="string">'Long Axis (pixels)'</span>);
0650                             xlabel(<span class="string">'Time (frames)'</span> );
0651                             disp(<span class="string">'Press enter to continue'</span>);
0652                             pause;
0653                             axis(tmp_axis);
0654                         <span class="keyword">end</span>
0655                         
0656                     <span class="keyword">end</span>
0657                 <span class="keyword">end</span>
0658             <span class="keyword">end</span>
0659         <span class="keyword">else</span>
0660             disp( <span class="string">'Not supported in this mode.'</span> );
0661         <span class="keyword">end</span>
0662         
0663        
0664     <span class="keyword">elseif</span> strcmp(c,<span class="string">'Movie'</span>)  <span class="comment">% Make Time-Lapse Images for Movies</span>
0665         setAxis = axis;
0666         nn_old = nn;       
0667         z_pad = ceil(log(num_im)/log(10));
0668 
0669         movdir = <span class="string">'mov'</span>;
0670         <span class="keyword">if</span> ~exist( movdir, <span class="string">'dir'</span> )
0671             mkdir( movdir );
0672         <span class="keyword">end</span>
0673         file_tmp = [<span class="string">'%0'</span>,num2str(z_pad),<span class="string">'d'</span>];
0674         
0675         <span class="keyword">for</span> nn = 1:num_im
0676             
0677             [data_r, data_c, data_f] = <a href="#_sub5" class="code" title="subfunction [data_r, data_c, data_f] = intLoadData( dirname, ">intLoadData</a>( dirname, <span class="keyword">...</span>
0678                 D_FLAG, contents, nn, num_im, nameInfo, clist, dirnum);
0679             
0680             <span class="comment">%clf;</span>
0681             tmp_im = <a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>( data_c,data_r, data_f, FLAGS, clist, CONST);
0682             <span class="comment">%axis(setAxis);</span>
0683             
0684             drawnow;
0685             disp( [<span class="string">'Frame number: '</span>, num2str(nn)] );
0686             
0687             <span class="comment">%tmp_im = frame2im(getframe);</span>
0688             imwrite( tmp_im, [movdir,filesep,<span class="string">'mov'</span>,sprintf(file_tmp,nn),<span class="string">'.tif'</span>], <span class="string">'TIFF'</span>, <span class="string">'Compression'</span>, <span class="string">'none'</span> );
0689             
0690         <span class="keyword">end</span>
0691         nn = nn_old;
0692         resetFlag = true;
0693         
0694 
0695         
0696     <span class="comment">%% DEVELOPER TOOLS : Use at your own risk</span>
0697     <span class="keyword">elseif</span> c(1) == <span class="string">'e'</span> <span class="comment">% Show Error List</span>
0698         FLAGS.e_flag = ~FLAGS.e_flag;
0699                
0700     <span class="keyword">elseif</span> c(1) == <span class="string">'v'</span>  <span class="comment">% Toggle between cell view and region view</span>
0701         FLAGS.v_flag = ~FLAGS.v_flag;       
0702       
0703     <span class="keyword">elseif</span> strcmp(c,<span class="string">'editSegs'</span>)  <span class="comment">% Edit Segments</span>
0704         segsTLEdit( dirname, nn);
0705         
0706     <span class="keyword">elseif</span> strcmp(c, <span class="string">'relink'</span>) <span class="comment">% Re-Link</span>
0707         delete([dirname_cell,<span class="string">'*.mat'</span>]);
0708         delete([dirname,<span class="string">'*trk.mat*'</span>]);
0709         delete([dirname,<span class="string">'*err.mat*'</span>]);
0710         delete([dirname,<span class="string">'.trackOpti*'</span>]);
0711         delete([dirname_xy,<span class="string">'clist.mat'</span>]);        
0712         <span class="comment">% Re-Run trackOpti</span>
0713         skip = 1;
0714         CLEAN_FLAG = false;
0715         header = <span class="string">'trackOptiView: '</span>;
0716         trackOpti(dirname_xy,skip,CONST, CLEAN_FLAG, header);   
0717     
0718     <span class="keyword">elseif</span> c(1) == <span class="string">'n'</span>; <span class="comment">% pick region and ignore error</span>
0719         <span class="keyword">if</span> FLAGS.T_flag
0720             disp( <span class="string">'Tight flag must be off'</span>);
0721         <span class="keyword">else</span>           
0722             x = floor(ginput(1));
0723             
0724             <span class="keyword">if</span> ~isempty(x)
0725                 ii = data_c.regs.regs_label(x(2),x(1));
0726                 tmp_axis = axis();
0727                                
0728                 <span class="keyword">if</span> ~ii
0729                     disp(<span class="string">'missed region'</span>);
0730                 <span class="keyword">else</span>
0731                     
0732                     <span class="keyword">if</span> isfield( data_c.regs, <span class="string">'ignoreError'</span> )
0733                         disp([<span class="string">'Picked region '</span>,num2str(ii)]);                                             
0734                         data_c.regs.ignoreError(ii) = 1;                        
0735                         save([dirname,contents(nn  ).name],<span class="string">'-STRUCT'</span>,<span class="string">'data_c'</span>);
0736                     <span class="keyword">else</span>                        
0737                         disp( <span class="string">'Ignore error not implemented for your version of trackOpti.'</span>);                        
0738                     <span class="keyword">end</span>
0739                 <span class="keyword">end</span>
0740             <span class="keyword">end</span>
0741             
0742         <span class="keyword">end</span>
0743         
0744         
0745     <span class="keyword">elseif</span> strcmp(c,<span class="string">'link'</span>); <span class="comment">% Reset Linking in Current Frame</span>
0746         
0747         <span class="keyword">if</span> FLAGS.T_flag
0748             disp( <span class="string">'Tight flag must be off'</span>);
0749         <span class="keyword">else</span>                      
0750             disp(<span class="string">'pick region to reset linking in the current frame'</span>);            
0751             x = floor(ginput(1));
0752             
0753             <span class="keyword">if</span> ~isempty(x)
0754                 ii = data_c.regs.regs_label(x(2),x(1));
0755                 tmp_axis = axis();
0756                 
0757                 
0758                 <span class="keyword">if</span> ~ii
0759                     disp(<span class="string">'missed region'</span>);
0760                 <span class="keyword">else</span>
0761                     disp([<span class="string">'Picked region '</span>,num2str(ii)]);
0762                     <a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>( data_f,data_c, data_f, FLAGS, clist, CONST);
0763                     axis( tmp_axis );
0764                     
0765                     disp( <span class="string">'Click on linked cell(s). press enter to return'</span>);
0766                     x = floor(ginput());
0767                     
0768                     ss = size(x);
0769                     
0770                     list_of_regs = [];
0771                     
0772                     <span class="keyword">for</span> hh = 1:ss(1);
0773                         
0774                         jj = data_f.regs.regs_label(x(hh,2),x(hh,1));
0775                         <span class="keyword">if</span> jj
0776                             list_of_regs = [list_of_regs, jj];
0777                         <span class="keyword">end</span>
0778                     <span class="keyword">end</span>
0779                     
0780                     <span class="keyword">if</span> ~isempty(list_of_regs)
0781                         
0782                         <span class="comment">%list_of_regs</span>
0783                         
0784                         
0785                         data_c.regs.ol.f{ii}    = zeros(2, 5);
0786                         
0787                         nnn = min([5,numel(list_of_regs)]);
0788                         
0789                         data_c.regs.ol.f{ii}(1,1:nnn) = 1;
0790                         data_c.regs.ol.f{ii}(2,1:nnn) = list_of_regs(1:nnn);
0791                         data_c.regs.map.f{ii}   = list_of_regs;
0792                         data_c.regs.error.f(ii) = double(numel(list_of_regs)&gt;1);
0793                         data_c.regs.ignoreError(ii) = 1;
0794                         
0795                         <span class="keyword">for</span> kk = list_of_regs
0796                             
0797                             data_f.regs.ol.r{kk}     = zeros(2,5);
0798                             
0799                             data_f.regs.ol.r{kk}(1,1)= 1/numel(list_of_regs);
0800                             data_f.regs.ol.r{kk}(2,1)= ii;
0801                             
0802                             data_f.regs.dA.r(kk)     = 1/numel(list_of_regs);
0803                             data_f.regs.map.r{kk}    = ii;
0804                             data_f.regs.error.r(kk)  = double(numel(list_of_regs)&gt;1);
0805                             data_f.regs.ignoreError(kk) = 1;
0806                         <span class="keyword">end</span>
0807                         
0808                         <span class="comment">% Save files....</span>
0809                         
0810                         save([dirname,contents(nn  ).name],<span class="string">'-STRUCT'</span>,<span class="string">'data_c'</span>);
0811                         save([dirname,contents(nn+1).name],<span class="string">'-STRUCT'</span>,<span class="string">'data_f'</span>);
0812                         
0813                     <span class="keyword">end</span>
0814                 <span class="keyword">end</span>
0815             <span class="keyword">end</span>
0816         <span class="keyword">end</span>
0817         
0818         
0819         
0820     <span class="keyword">elseif</span> strcmp(c,<span class="string">'errRez'</span>); <span class="comment">% ReRun Error Resolution and  linking code trackOpti</span>
0821         ctmp = input(<span class="string">'Are you sure you want to re-run error resolution? (y/n): '</span>,<span class="string">'s'</span>);
0822         
0823         <span class="keyword">if</span> ismember(ctmp(1),<span class="string">'yY'</span>)
0824             <span class="comment">% Erase all stamp files after .trackOptiSetEr.mat</span>
0825             contents_stamp = dir( [dirname,filesep,<span class="string">'.trackOpti*'</span>] );
0826             num_stamp = numel( contents_stamp );
0827             
0828             <span class="keyword">for</span> iii = 1:num_stamp               
0829                 <span class="keyword">if</span> isempty( strfind( contents_stamp(iii).name,<span class="keyword">...</span>
0830                         <span class="string">'.trackOptiLink.mat'</span>  ) ) &amp;&amp; <span class="keyword">...</span>
0831                         isempty( strfind( contents_stamp(iii).name,<span class="keyword">...</span>
0832                         <span class="string">'.trackOptiErRes1.mat'</span>) ) &amp;&amp; <span class="keyword">...</span>
0833                         isempty( strfind( contents_stamp(iii).name,<span class="keyword">...</span>
0834                         <span class="string">'.trackOptiSetEr.mat'</span> ) )
0835                     <span class="keyword">if</span> ispc
0836                         eval([<span class="string">'!del '</span>,dirname,filesep,<span class="keyword">...</span>
0837                             contents_stamp(iii).name]);
0838                     <span class="keyword">else</span>
0839                         eval([<span class="string">'!\rm '</span>,dirname,filesep,<span class="keyword">...</span>
0840                             contents_stamp(iii).name]);
0841                     <span class="keyword">end</span>
0842                     
0843                 <span class="keyword">end</span>
0844             <span class="keyword">end</span>
0845             
0846             <span class="keyword">if</span> ispc
0847                 eval([<span class="string">'!del '</span>,dirname_cell,<span class="string">'*.mat'</span>]);
0848                 eval([<span class="string">'!del '</span>,dirname_xy,<span class="string">'clist.mat'</span>]);
0849             <span class="keyword">else</span>
0850                 eval([<span class="string">'!\rm '</span>,dirname_cell,<span class="string">'*.mat'</span>]);
0851                 eval([<span class="string">'!\rm '</span>,dirname_xy,<span class="string">'clist.mat'</span>]);
0852             <span class="keyword">end</span>
0853             
0854             <span class="comment">% Re-Run trackOpti</span>
0855             skip = 1;
0856             CLEAN_FLAG = false;
0857             header = <span class="string">'trackOptiView: '</span>;
0858             trackOpti(dirname_xy,skip,CONST, CLEAN_FLAG, header);
0859             
0860         <span class="keyword">end</span>
0861         
0862     <span class="keyword">else</span>
0863         <span class="comment">% we assume that it is a number for a frame change.</span>
0864         tmp_nn = str2num(c);
0865         <span class="keyword">if</span> ~isempty(tmp_nn)
0866             nn = tmp_nn;
0867             <span class="keyword">if</span> nn &gt; num_im;
0868                 nn = num_im;
0869             <span class="keyword">elseif</span> nn&lt; 1
0870                 nn = 1;
0871             <span class="keyword">end</span>
0872         <span class="keyword">end</span>
0873         resetFlag = true;
0874         
0875     <span class="keyword">end</span>
0876     
0877 <span class="keyword">end</span>
0878 
0879 <span class="keyword">try</span>
0880     save(filename_flags, <span class="string">'FLAGS'</span>, <span class="string">'nn'</span>, <span class="string">'dirnum'</span>, <span class="string">'error_list'</span> );
0881 <span class="keyword">catch</span>
0882     disp(<span class="string">'Error saving flag preferences.'</span>);
0883 <span class="keyword">end</span>
0884 
0885 <span class="keyword">end</span>
0886 
0887 
0888 <span class="comment">% END OF MAIN FUNCTION (trackOptiView)</span>
0889 
0890 
0891 <span class="comment">%% INTERNAL FUNCTIONS</span>
0892 
0893 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0894 <span class="comment">%</span>
0895 <span class="comment">% loaderInternal</span>
0896 <span class="comment">%</span>
0897 <span class="comment">% Load Date and put in outline fields.</span>
0898 <span class="comment">%</span>
0899 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0900 <a name="_sub1" href="#_subfunctions" class="code">function data = loaderInternal( filename, clist )</a>
0901 data = load( filename );
0902 ss = size( data.phase );
0903 
0904 <span class="keyword">if</span> isfield( data, <span class="string">'mask_cell'</span> )
0905     data.outline =  xor(bwmorph( data.mask_cell, <span class="string">'dilate'</span> ), data.mask_cell);
0906 <span class="keyword">end</span>
0907 
0908 
0909 <span class="keyword">if</span> isempty( clist )
0910     
0911 <span class="keyword">else</span>
0912     clist = gate(clist);
0913     
0914     data.cell_outline = false(ss);
0915     
0916     <span class="comment">%tic</span>
0917     <span class="keyword">if</span> isfield( data, <span class="string">'regs'</span> ) &amp;&amp; isfield( data.regs, <span class="string">'ID'</span> )
0918         
0919         ind = find(ismember(data.regs.ID,clist.data(:,1)));
0920         
0921         <span class="comment">%     for ii = ind</span>
0922         <span class="comment">%         [xx,yy] = getBBpad(data.regs.props(ii).BoundingBox,ss,1);</span>
0923         <span class="comment">%</span>
0924         <span class="comment">%         mask_tmp = data.regs.regs_label(yy,xx)==ii;</span>
0925         <span class="comment">%         data.cell_outline(yy,xx) = or( data.cell_outline(yy,xx), ...</span>
0926         <span class="comment">%             xor(bwmorph( mask_tmp, 'dilate' ),...</span>
0927         <span class="comment">%             mask_tmp));</span>
0928         <span class="comment">%     end</span>
0929         
0930         mask_tmp = ismember( data.regs.regs_label, ind );
0931         
0932         data.cell_outline = xor(bwmorph( mask_tmp, <span class="string">'dilate'</span> ), mask_tmp);
0933         
0934     <span class="keyword">end</span>
0935 <span class="keyword">end</span>
0936 <span class="comment">%toc</span>
0937 
0938 <span class="keyword">end</span>
0939 
0940 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0941 <span class="comment">%</span>
0942 <span class="comment">% getDirStruct</span>
0943 <span class="comment">%</span>
0944 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0945 <a name="_sub2" href="#_subfunctions" class="code">function [nameInfo] = getDirStruct( dirname )</a>
0946 
0947 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0948 contents = dir( [dirname,filesep,<span class="string">'*.tif'</span>] );
0949 
0950 nt  = [];
0951 nc  = [];
0952 nxy = [];
0953 nz  = [];
0954 
0955 num_im = numel(contents);
0956 
0957 <span class="keyword">for</span> i = 1:num_im;
0958     nameInfo = ReadFileName( contents(i).name );
0959     
0960     nt  = [nt,  nameInfo.npos(1,1)];
0961     nc  = [nc,  nameInfo.npos(2,1)];
0962     nxy = [nxy, nameInfo.npos(3,1)];
0963     nz  = [nz,  nameInfo.npos(4,1)];
0964 <span class="keyword">end</span>
0965 
0966 nt  = sort(unique(nt));
0967 nc  = sort(unique(nc));
0968 nxy = sort(unique(nxy));
0969 nz  = sort(unique(nz));
0970 
0971 xyPadSize = floor(log(max(nxy))/log(10))+1;
0972 padString = [<span class="string">'%0'</span>,num2str(xyPadSize),<span class="string">'d'</span>];
0973 
0974 num_xy = numel(nxy);
0975 num_c  = numel(nc);
0976 num_z  = numel(nz);
0977 num_t  = numel(nt);
0978 
0979 
0980 nameInfo.nt  = nt;
0981 nameInfo.nc  = nc;
0982 nameInfo.nxy = nxy;
0983 nameInfo.nz  = nz;
0984 
0985 <span class="keyword">end</span>
0986 
0987 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0988 <span class="comment">%</span>
0989 <span class="comment">% getPadSize</span>
0990 <span class="comment">%</span>
0991 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0992 <a name="_sub3" href="#_subfunctions" class="code">function padStr = getPadSize( dirname )</a>
0993 
0994 contents = dir([dirname,<span class="string">'*ell*.mat'</span>]);
0995 
0996 <span class="keyword">if</span> numel(contents) == 0
0997     disp(<span class="string">'No cell files'</span> );
0998     padStr = []
0999 <span class="keyword">else</span>
1000     num_num = sum(ismember(contents(1).name,<span class="string">'1234567890'</span>));
1001     padStr = [<span class="string">'%0'</span>,num2str(num_num),<span class="string">'d'</span>];
1002 <span class="keyword">end</span>
1003 
1004 <span class="keyword">end</span>
1005 
1006 
1007 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1008 <span class="comment">%</span>
1009 <span class="comment">% intGetNum</span>
1010 <span class="comment">%</span>
1011 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1012 <a name="_sub4" href="#_subfunctions" class="code">function ixy = intGetNum( str_xy )</a>
1013 ixy = str2num(str_xy(ismember(str_xy, <span class="string">'0123456789'</span> )));
1014 <span class="keyword">end</span>
1015 
1016 
1017 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1018 <span class="comment">%</span>
1019 <span class="comment">% intLoadData</span>
1020 <span class="comment">%</span>
1021 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1022 <a name="_sub5" href="#_subfunctions" class="code">function [data_r, data_c, data_f] = intLoadData( dirname, </a><span class="keyword">...</span>
1023     D_FLAG, contents, nn, num_im, nameInfo, clist, ixy)
1024 
1025 
1026 <span class="keyword">if</span> (D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>) || (D_FLAG == <a href="#_sub7" class="code" title="subfunction val = SD_FLAG()">SD_FLAG</a>)
1027     
1028     <span class="comment">%'start'</span>
1029     
1030     <span class="keyword">if</span> (nn ==1) &amp;&amp; (1 == num_im)
1031         data_r = [];
1032         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1033         data_f = [];
1034     <span class="keyword">elseif</span> nn == 1;
1035         data_r = [];
1036         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1037         data_f = [];
1038         <span class="comment">%data_f = loaderInternal([dirname,contents(nn+1).name], clist);</span>
1039         <span class="comment">%data_ff= loaderInternal([dirname,contents(nn+2).name]);</span>
1040     <span class="keyword">elseif</span> nn == num_im
1041         <span class="comment">%data_r = loaderInternal([dirname,contents(nn-1).name], clist);</span>
1042         data_r = [];
1043         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1044         data_f = [];
1045         <span class="comment">%data_ff= [];</span>
1046     <span class="keyword">elseif</span> nn == num_im-1
1047         <span class="comment">%data_r = loaderInternal([dirname,contents(nn-1).name], clist);</span>
1048         data_r = [];
1049         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1050         data_f = [];
1051         <span class="comment">%data_f = loaderInternal([dirname,contents(nn+1).name], clist);</span>
1052         <span class="comment">%data_ff= [];</span>
1053     <span class="keyword">else</span>
1054         
1055         <span class="keyword">if</span> 1
1056             data_r = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn-1).name], clist);
1057             data_f = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn+1).name], clist);
1058         <span class="keyword">else</span>
1059             data_r = [];
1060             data_f = [];
1061         <span class="keyword">end</span>
1062         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1063         <span class="comment">%data_ff= loaderInternal([dirname,contents(nn+1).name]);</span>
1064     <span class="keyword">end</span>
1065     
1066     <span class="comment">%'finish'</span>
1067     
1068 <span class="keyword">else</span>
1069     
1070     data_f = [];
1071     data_r = [];
1072     data_c = [];
1073     
1074     <span class="comment">% it  = nameInfo.npos(1,1);</span>
1075     <span class="comment">% ic  = nameInfo.npos(2,1);</span>
1076     <span class="comment">% ixy = nameInfo.npos(3,1);</span>
1077     <span class="comment">% iz  = nameInfo.npos(4,1);</span>
1078     
1079     nameInfo.npos(1,1) = nameInfo.nt(nn);
1080     nameInfo.npos(3,1) = nameInfo.nxy(ixy);
1081     nameInfo.npos(2,1) = 1;
1082     nameInfo.npos(4,1) = 1;
1083     
1084     name = [dirname,MakeFileName(nameInfo)];
1085     
1086     
1087     data_c.phase = imread(name);
1088     <span class="keyword">for</span> ic = nameInfo.nc(2:end)
1089         
1090         nameInfo.npos(2,1) = nameInfo.nc(ic);
1091         name = [dirname,MakeFileName(nameInfo)];
1092         
1093         tmp = imread(name);
1094         data_c = setfield( data_c, [<span class="string">'fluor'</span>,num2str(ic-1)], tmp );
1095     <span class="keyword">end</span>
1096 <span class="keyword">end</span>
1097 
1098 
1099 
1100 
1101 
1102 <span class="keyword">end</span>
1103 
1104 <span class="comment">% Do directory handling</span>
1105 <span class="comment">% Sense whether trackOptiView is being launched with an align of seg</span>
1106 <span class="comment">% directory.</span>
1107 <a name="_sub6" href="#_subfunctions" class="code">function val = AD_FLAG()</a>
1108 val = 0;
1109 <span class="keyword">end</span>
1110 <a name="_sub7" href="#_subfunctions" class="code">function val = SD_FLAG()</a>
1111 val = 1;
1112 <span class="keyword">end</span>
1113 <a name="_sub8" href="#_subfunctions" class="code">function val = ND_FLAG()</a>
1114 val = 2;
1115 <span class="keyword">end</span>
1116 
1117 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1118 <span class="comment">%</span>
1119 <span class="comment">% intDispError</span>
1120 <span class="comment">%</span>
1121 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1122 <a name="_sub9" href="#_subfunctions" class="code">function intDispError( data_c, FLAGS )</a>
1123 
1124 <span class="keyword">for</span> kk = 1:data_c.regs.num_regs
1125     <span class="keyword">if</span> isfield(data_c,<span class="string">'regs'</span>) &amp;&amp;<span class="keyword">...</span>
1126             isfield(data_c.regs, <span class="string">'error'</span>) &amp;&amp; <span class="keyword">...</span>
1127             isfield(data_c.regs.error,<span class="string">'label'</span>) &amp;&amp; <span class="keyword">...</span>
1128             ~isempty( data_c.regs.error.label{kk} )
1129         <span class="keyword">if</span> FLAGS.v_flag &amp;&amp; isfield( data_c.regs, <span class="string">'ID'</span> )
1130             disp(  [<span class="string">'Cell: '</span>, num2str(data_c.regs.ID(kk)), <span class="string">', '</span>, <span class="keyword">...</span>
1131                 data_c.regs.error.label{kk}] );
1132         <span class="keyword">else</span>
1133             disp(  [ data_c.regs.error.label{kk}] );
1134         <span class="keyword">end</span>
1135     <span class="keyword">end</span>
1136 <span class="keyword">end</span>
1137 <span class="keyword">end</span>
1138 
1139 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1140 <span class="comment">%</span>
1141 <span class="comment">% intSetDefaultFlags</span>
1142 <span class="comment">%</span>
1143 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1144 <a name="_sub10" href="#_subfunctions" class="code">function FLAGS = intSetDefaultFlags()</a>
1145 
1146 FLAGS.v_flag  = 1;
1147 FLAGS.m_flag  = 0;
1148 FLAGS.t_flag  = 0;
1149 FLAGS.T_flag  = 0;
1150 FLAGS.ID_flag = 1;
1151 FLAGS.P_flag  = 1;
1152 FLAGS.e_flag  = 0;
1153 FLAGS.f_flag  = 0;
1154 FLAGS.s_flag  = 1;
1155 FLAGS.p_flag  = 0;
1156 FLAGS.c_flag  = 1;
1157 FLAGS.lyse_flag = false;
1158 FLAGS.err_flag = false;
1159 
1160 <span class="keyword">end</span>
1161 
1162 
1163 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1164 <span class="comment">%</span>
1165 <span class="comment">% intSetDefaultFlags</span>
1166 <span class="comment">%</span>
1167 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1168 <a name="_sub11" href="#_subfunctions" class="code">function intCons(dirname0, contents_xy, dircons, setHeader, CONST)</a>
1169 <span class="comment">%try</span>
1170 
1171 ixy = <a href="#_sub4" class="code" title="subfunction ixy = intGetNum( str_xy )">intGetNum</a>( contents_xy.name );
1172 header = [<span class="string">'xy'</span>,num2str(ixy),<span class="string">': '</span>];
1173 
1174 <span class="keyword">if</span> exist([dircons, <span class="string">'consColor_'</span>, setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>])
1175     disp(<span class="string">'Consensus Already Calculated'</span>)
1176     imColor = imread([dircons, <span class="string">'consColor_'</span>, setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>]);
1177     figure(1)
1178     clf
1179     imshow(imColor);
1180     disp(<span class="string">'Press any key to continue'</span>)
1181     pause
1182     
1183 <span class="keyword">else</span>
1184     
1185     disp(<span class="string">'No Images Found.'</span>)
1186     disp(<span class="string">'Calculate New Consensus?'</span>)
1187     d = input(<span class="string">'[y/n]:'</span>,<span class="string">'s'</span>);
1188     
1189     <span class="keyword">if</span> strcmp(d,<span class="string">'y'</span>)
1190         
1191         <span class="keyword">if</span> isdir([dirname0,contents_xy.name,filesep,<span class="string">'seg_full'</span>])
1192             dirname = [dirname0,contents_xy.name,filesep,<span class="string">'seg_full'</span>,filesep];
1193         <span class="keyword">end</span>
1194         
1195         dirname_cell = [dirname0,contents_xy.name,filesep,<span class="string">'cell'</span>,filesep];
1196         
1197         disp( [<span class="string">'Doing '</span>,num2str(ixy)] );
1198         
1199         <span class="comment">%makeFrameStripeMosaicCenter( [dirname_cell], CONST, ll_ );</span>
1200         <span class="comment">%[imTot, imColor, imBW, imInv, kymo, kymoMask, I ] = ...</span>
1201         <span class="comment">%    makeFrameStripeMosaicCenterMag( [dirname_cell], CONST, [], 0, 0 );</span>
1202         <span class="comment">%[imTot, imColor, imBW, imInv, kymo, kymoMask, I ] = ...</span>
1203         <span class="comment">%    makeFrameStripeMosaicCenter2( [dirname_cell], CONST, ll_ );</span>
1204         [imTot, imColor, imBW, imInv, kymo, kymoMask, I, jjunk, jjunk, imTot10 ] = <span class="keyword">...</span>
1205             <a href="makeConsIm.html" class="code" title="function [ imMosaic, imColor, imBW, imInv, kymo, kymoMask, I,kymoMax, kymoMaskMax, imMosaic10, imBWunmasked, imBWmask, hotPix,AA, BB ] = makeConsIm( dirName, CONST, skip, mag, disp_flag )">makeConsIm</a>( [dirname_cell], CONST, [], [], false );
1206         
1207         figure(1)
1208         clf
1209         imshow(imColor)
1210         
1211         disp(<span class="string">'Press any key to continue'</span>)
1212         pause
1213         
1214         <span class="keyword">if</span> ~isempty( imTot )
1215             imwrite( imBW,    [dircons, <span class="string">'consBW_'</span>,    setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
1216             imwrite( imColor, [dircons, <span class="string">'consColor_'</span>, setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
1217             imwrite( imInv,   [dircons, <span class="string">'consInv_'</span>,   setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
1218             imwrite( imTot10,   [dircons, <span class="string">'typical_'</span>,   setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
1219             
1220             <span class="comment">%figure(99);</span>
1221             <span class="comment">%print( '-depsc', [dircons, 'dyn', num2str(ixy,'%02d'), '.eps'] );</span>
1222             
1223             save( [dircons, <span class="string">'fits'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.mat'</span>], <span class="string">'I'</span> );
1224         <span class="keyword">else</span>
1225             
1226             disp( [<span class="string">'Found no cells in '</span>, dirname_cell, <span class="string">'.'</span>] );
1227         <span class="keyword">end</span>
1228         
1229     <span class="keyword">else</span>
1230         
1231         <span class="keyword">return</span>
1232         
1233     <span class="keyword">end</span>
1234     <span class="comment">%catch</span>
1235     <span class="comment">%disp( ['Error ',num2str(ixy)] );</span>
1236     
1237 <span class="keyword">end</span>
1238 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 23-Feb-2016 16:32:17 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>