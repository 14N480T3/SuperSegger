<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of cellpropsPseud</title>
  <meta name="keywords" content="cellpropsPseud">
  <meta name="description" content="cellpropsPseud Calculates the shape properties of the region or 'cell'">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">SuperSeggerRelease</a> &gt; <a href="index.html">segmentation</a> &gt; cellpropsPseud.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for SuperSeggerRelease/segmentation&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>cellpropsPseud
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>cellpropsPseud Calculates the shape properties of the region or 'cell'</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function info = cellpropsPseud ( mask, props ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> cellpropsPseud Calculates the shape properties of the region or 'cell'

 INPUT :
       mask : cell / region mask
       props : proper generated by regionprops
 OUTPUT :
         info = [L1
             L2mean,
             Lneck,
             L2max,
             L2v,
             s1,
             s2,
             s3,
             RoundIndOver,
             RoundIndUnder,
             props.Area,
             stm1,
             sa1,
             sa2,
             sa3,
             sa4,
             1/L1,
             1/L2mean,
             minWidthEnd,
             sqmin,
             sqmax];

 Copyright (C) 2016 Wiggins Lab
 University of Washington, 2016
 This file is part of SuperSeggerOpti..</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="watershedNoise.html" class="code" title="function [ws,num] = watershedNoise( im, minStep )">watershedNoise</a>	watershedNoise uses watershed on an image and adds noise</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function tmp = norm2( dd )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function info = cellpropsPseud ( mask, props )</a>
0002 <span class="comment">% cellpropsPseud Calculates the shape properties of the region or 'cell'</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% INPUT :</span>
0005 <span class="comment">%       mask : cell / region mask</span>
0006 <span class="comment">%       props : proper generated by regionprops</span>
0007 <span class="comment">% OUTPUT :</span>
0008 <span class="comment">%         info = [L1</span>
0009 <span class="comment">%             L2mean,</span>
0010 <span class="comment">%             Lneck,</span>
0011 <span class="comment">%             L2max,</span>
0012 <span class="comment">%             L2v,</span>
0013 <span class="comment">%             s1,</span>
0014 <span class="comment">%             s2,</span>
0015 <span class="comment">%             s3,</span>
0016 <span class="comment">%             RoundIndOver,</span>
0017 <span class="comment">%             RoundIndUnder,</span>
0018 <span class="comment">%             props.Area,</span>
0019 <span class="comment">%             stm1,</span>
0020 <span class="comment">%             sa1,</span>
0021 <span class="comment">%             sa2,</span>
0022 <span class="comment">%             sa3,</span>
0023 <span class="comment">%             sa4,</span>
0024 <span class="comment">%             1/L1,</span>
0025 <span class="comment">%             1/L2mean,</span>
0026 <span class="comment">%             minWidthEnd,</span>
0027 <span class="comment">%             sqmin,</span>
0028 <span class="comment">%             sqmax];</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% Copyright (C) 2016 Wiggins Lab</span>
0031 <span class="comment">% University of Washington, 2016</span>
0032 <span class="comment">% This file is part of SuperSeggerOpti..</span>
0033 
0034 Orientation = props.Orientation;
0035 <span class="comment">%ss = size(regs_label);</span>
0036 
0037 <span class="comment">%[xx,yy] = getBBpad(props(ii).BoundingBox, ss, 2);</span>
0038 
0039 <span class="comment">%mask = regs_label(yy,xx)==ii;</span>
0040 
0041 debug = false;
0042 <span class="comment">%imRot = imrotate( mask, -props.Orientation+90 );</span>
0043 <span class="comment">%imRot = mask;</span>
0044 dr  = 5;
0045 dr2 = 3;
0046 <span class="comment">%imRot = logical(fast_rotate_loose( uint8(mask), -props.Orientation+90 ));</span>
0047 imRot = (fast_rotate_loose_double( uint8(mask), -Orientation+90 ));
0048 ss = size(imRot);
0049 
0050 <span class="keyword">if</span> debug
0051     clf;
0052     imshow(cat(3,ag(imRot)+0.5*ag(~imRot),ag(imRot),ag(imRot)));
0053     hold on;
0054 <span class="keyword">end</span>
0055 
0056 width = sum(imRot,2);
0057 ymask = logical(width&gt;=1);
0058 widthWindow = ([0;width(1:end-1)] + width + [width(2:end);0] )/3;
0059 
0060 L1 = sum(ymask);
0061 L2max = max(widthWindow);
0062 
0063 y = 1:ss(1);
0064 x = 1:ss(2);
0065 
0066 ymin = min(y(ymask));
0067 ymax = max(y(ymask));
0068 
0069 L2mean = mean(width((ymin):(ymax)));
0070 <span class="comment">%L2var = var(width((ymin):(ymax)))./L2mean^2;</span>
0071 
0072 minStep = 1;
0073 [ws,num_ws] = <a href="watershedNoise.html" class="code" title="function [ws,num] = watershedNoise( im, minStep )">watershedNoise</a>(widthWindow, minStep);
0074 
0075 <span class="keyword">if</span> num_ws &gt; 2
0076     ind = find(ismember( ws,2:(num_ws-1)));
0077     [Lneck,pos] = min(widthWindow(ind));
0078     pos = ind(pos);
0079     
0080     <span class="keyword">if</span> debug
0081         plot( x,x*0+pos, <span class="string">'r:'</span> );
0082     <span class="keyword">end</span>
0083 <span class="keyword">else</span>
0084     Lneck = L2mean;
0085     pos = mean([ymin,ymax]);
0086     <span class="keyword">if</span> debug
0087         plot( x,x*0+pos, <span class="string">'k:'</span> );
0088     <span class="keyword">end</span>
0089 <span class="keyword">end</span>
0090 
0091 
0092 
0093 
0094 
0095 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0096 yy = (ymin+dr):dr2:(ymax-dr);
0097 
0098 <span class="keyword">if</span> numel(yy) &gt; 4
0099     tmp = imRot(yy,:);
0100     
0101     [X,Y] = meshgrid(x,yy);
0102     
0103     xx = sum( X.*tmp,2 )./sum(tmp,2);
0104     
0105     d1 = [xx(1:end-2)-xx(3:end),yy(1:end-2)'-yy(3:end)'];
0106     
0107     stm = abs((d1(1:end-2,1).*d1(3:<span class="keyword">end</span>,2)<span class="keyword">...</span>
0108         -d1(1:end-2,2).*d1(3:<span class="keyword">end</span>,1))./<span class="keyword">...</span>
0109         (<a href="#_sub1" class="code" title="subfunction tmp = norm2( dd )">norm2</a>(d1(1:end-2,:)).*<a href="#_sub1" class="code" title="subfunction tmp = norm2( dd )">norm2</a>(d1(3:<span class="keyword">end</span>,:))));
0110     
0111     
0112     stm = max( stm );
0113     
0114     <span class="keyword">if</span> debug
0115         
0116         ss_ = size(d1);
0117         
0118         <span class="keyword">for</span> ii = 1:ss_(1)
0119             
0120             plot( xx(ii)+[0,-d1(ii,1)], yy(ii)+[0,-d1(ii,2)], <span class="string">'c.'</span> );
0121         <span class="keyword">end</span>
0122     <span class="keyword">end</span>
0123     
0124     
0125     <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0126     
0127     yy = [(ymin+dr),(ymax-dr)];
0128     xx = widthWindow(round(yy));
0129     r = ((xx)/2);
0130     
0131     
0132     yyd = [(ymin+r(1)+[-1,0,1]),(ymax-r(2)+[-1,0,1])];
0133     yy  = round(yyd);
0134     
0135     [X,Y] = meshgrid(x,yy);
0136     tmp = imRot(yy,:);
0137     xx = sum( X.*tmp,2 )./sum(tmp,2);
0138     xx = [mean(xx(1:3)),mean(xx(4:6))];
0139     yyd = yyd([2,5]);
0140     yy  = yy([2,5]);
0141     
0142     <span class="keyword">if</span> debug
0143         phi = 0:.1:2*pi;
0144         
0145         plot(xx,yyd,<span class="string">'go'</span>);
0146         xxx = r(1)*cos(phi);
0147         yyy = r(1)*sin(phi);
0148         plot(xx(1)+xxx,yy(1)+yyy,<span class="string">'g:'</span>)
0149         
0150         xxx = r(2)*cos(phi);
0151         yyy = r(2)*sin(phi);
0152         plot(xx(2)+xxx,yyd(2)+yyy,<span class="string">'g:'</span>)
0153         
0154         plot( [1,ss(2)],[ymax,ymax],<span class="string">':r'</span>)
0155         plot( [1,ss(2)],[ymin,ymin],<span class="string">':r'</span>)
0156         
0157     <span class="keyword">end</span>
0158     
0159     xcen = xx;
0160     ycen = yyd;
0161     
0162     x0 = xcen(1);
0163     y0 = ycen(1);
0164     r0 = r(1);
0165     
0166     yy = max(1,round(y0-r0-2)):min(round(y0+r0+2),ss(1));
0167     xx = max(1,round(x0-r0-2)):min(round(x0+r0+2),ss(2));
0168     
0169     [X,Y] = meshgrid(xx,yy);
0170     tmp = imRot(yy,xx);
0171     
0172     R2 = (X-x0).^2 + (Y-y0).^2 - r0^2;
0173     
0174     ind_over = find( ((R2 &gt; 0).*tmp).*(d1(1,1)*(X-x0) + d1(1,2)*(Y-y0) &gt; 0));
0175     ind_under = find( ((R2 &lt; 0).*(tmp&lt;1)).*(d1(1,1)*(X-x0) + d1(1,2)*(Y-y0) &gt; 0));
0176     
0177     
0178     <span class="keyword">if</span> debug
0179         plot(X(ind_over),Y(ind_over),<span class="string">'r.'</span>);
0180         plot(X(ind_under),Y(ind_under),<span class="string">'b.'</span>);
0181     <span class="keyword">end</span>
0182     
0183     RoundIndOverTop  = sum( tmp(ind_over).*R2(ind_over))/r0^4;
0184     RoundIndUnderTop = sum( (1-tmp(ind_under)).*abs(R2(ind_under)))/r0^4;
0185     
0186     x0 = xcen(2);
0187     y0 = ycen(2);
0188     r0 = r(2);
0189     
0190     yy = max(1,round(y0-r0-2)):min(round(y0+r0+2),ss(1));
0191     xx = max(1,round(x0-r0-2)):min(round(x0+r0+2),ss(2));
0192     
0193     [X,Y] = meshgrid(xx,yy);
0194     tmp = imRot(yy,xx);
0195     
0196     R2 = (X-x0).^2 + (Y-y0).^2 - r0^2;
0197     
0198     ind_over = find( ((R2 &gt; 0).*tmp).*(d1(1,1)*(X-x0) + d1(1,2)*(Y-y0) &lt; 0));
0199     ind_under = find( ((R2 &lt; 0).*(tmp&lt;1)).*(d1(1,1)*(X-x0) + d1(1,2)*(Y-y0) &lt; 0));
0200     
0201     <span class="keyword">if</span> debug
0202         plot(X(ind_over),Y(ind_over),<span class="string">'r.'</span>);
0203         plot(X(ind_under),Y(ind_under),<span class="string">'b.'</span>);
0204     <span class="keyword">end</span>
0205     
0206     
0207     RoundIndOverBot  = sum( tmp(ind_over).*R2(ind_over))/r0^4;
0208     RoundIndUnderBot = sum( (1-tmp(ind_under)).*abs(R2(ind_under)))/r0^4;
0209     
0210 <span class="keyword">else</span>
0211     <span class="comment">%'fail'</span>
0212     stm = 0;
0213     RoundIndOverTop  = 0;
0214     RoundIndUnderTop = 0;
0215     RoundIndOverBot  = 0;
0216     RoundIndUnderBot = 0;
0217     
0218 <span class="keyword">end</span>
0219 
0220 
0221 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0222 
0223     RoundIndOver  = RoundIndOverTop  + RoundIndOverBot;
0224     RoundIndUnder = RoundIndUnderTop + RoundIndUnderBot;
0225 
0226 
0227 Area = sum(double(logical(mask(:))));
0228 <span class="comment">%info = [L1,L2,Lneck,curve];</span>
0229 info = [L1,L2max,Lneck,L2mean, stm, RoundIndOver, RoundIndUnder, Area];
0230 info(isnan(info)) = 0;
0231 
0232 <span class="keyword">end</span>
0233 
0234 <a name="_sub1" href="#_subfunctions" class="code">function tmp = norm2( dd )</a>
0235 
0236 tmp = sqrt(sum(dd.*dd,2));
0237 
0238 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 23-Feb-2016 16:32:17 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>