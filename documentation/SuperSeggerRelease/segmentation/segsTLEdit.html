<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of segsTLEdit</title>
  <meta name="keywords" content="segsTLEdit">
  <meta name="description" content="segsTLEdit : used to visually modify segments in a frame.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">SuperSeggerRelease</a> &gt; <a href="index.html">segmentation</a> &gt; segsTLEdit.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for SuperSeggerRelease/segmentation&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>segsTLEdit
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>segsTLEdit : used to visually modify segments in a frame.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [touch_list] = segsTLEdit( dirname, frame_num ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> segsTLEdit : used to visually modify segments in a frame.
 Possible choices : q to quit
                    []  to modify
                    s  to save
                    g: go to frame n
                    1, 2, 3, &amp; 4 are different image modes
                    c  clear figure
              
 INPUT :
       dirname : xy directory
       frame_num : frame number
 OUTPUT :
       touch_list :</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function data = loaderInternal( filename )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [touch_list] = segsTLEdit( dirname, frame_num )</a>
0002 <span class="comment">% segsTLEdit : used to visually modify segments in a frame.</span>
0003 <span class="comment">% Possible choices : q to quit</span>
0004 <span class="comment">%                    []  to modify</span>
0005 <span class="comment">%                    s  to save</span>
0006 <span class="comment">%                    g: go to frame n</span>
0007 <span class="comment">%                    1, 2, 3, &amp; 4 are different image modes</span>
0008 <span class="comment">%                    c  clear figure</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% INPUT :</span>
0011 <span class="comment">%       dirname : xy directory</span>
0012 <span class="comment">%       frame_num : frame number</span>
0013 <span class="comment">% OUTPUT :</span>
0014 <span class="comment">%       touch_list :</span>
0015 
0016 
0017 tmpdir = pwd;
0018 
0019 cd(dirname);
0020 
0021 dirname = <span class="string">'.'</span>;
0022 
0023 <span class="keyword">if</span> ~exist(<span class="string">'disp_flag'</span>);
0024     disp_flag = 0;
0025 <span class="keyword">end</span>
0026 
0027 touch_list = [];
0028 
0029 <span class="keyword">if</span>(nargin&lt;1 || isempty(dirname))
0030     dirname=uigetdir()
0031 <span class="keyword">end</span>
0032 dirname = fixDir(dirname);
0033 
0034 contents=dir([dirname <span class="string">'*_seg.mat'</span>]);
0035 num_im = length(contents);
0036 
0037 im_flag = 1;
0038 runFlag = 1;
0039 
0040 <span class="keyword">if</span> nargin &lt; 2
0041     i = 1;
0042 <span class="keyword">else</span>
0043     i = frame_num;
0044 <span class="keyword">end</span>
0045 
0046 
0047 data = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename )">loaderInternal</a>([dirname,contents(i  ).name]);
0048 ss = size( data.segs.phaseMagic );
0049 
0050 <span class="keyword">while</span> runFlag
0051     
0052     data.mask_cell   = double((data.mask_bg - data.segs.segs_good - <span class="keyword">...</span>
0053         data.segs.segs_3n)&gt;0);
0054     
0055     showSegData( data, im_flag);
0056     figure(1);
0057     hold on;
0058     disp(<span class="string">'q to quit'</span>);
0059     disp(<span class="string">'[] to modify'</span>);
0060     disp(<span class="string">'s to save'</span> );
0061     disp(<span class="string">'g: go to frame n'</span>);
0062     disp(<span class="string">'1, 2, 3, &amp; 4 are different image modes'</span>);
0063     disp(<span class="string">'c clear the figure'</span>);
0064     disp([<span class="string">'Frame #: '</span>, num2str(i)] );
0065     
0066     c = input(<span class="string">':'</span>,<span class="string">'s'</span>)
0067     
0068     <span class="keyword">if</span> isempty(c)
0069         x = floor(ginput(1));
0070         tmp = zeros(ss);
0071         <span class="keyword">if</span> isempty(x)
0072             <span class="keyword">continue</span>;
0073         <span class="keyword">end</span>
0074         
0075         tmp(x(2),x(1)) = 1;
0076         tmp = 8000-double(bwdist(tmp));
0077         
0078         <span class="comment">%imshow( tmp, [] );</span>
0079         
0080         tmp = tmp.*(data.segs.segs_good+data.segs.segs_bad);
0081         [junk,ind] = max( tmp(:) );
0082         
0083         [sub1, sub2] = ind2sub( ss, ind );
0084         
0085         ii = data.segs.segs_label(sub1,sub2);
0086         
0087         plot( sub2, sub1, <span class="string">'r.'</span> );
0088         
0089         
0090         yymin = floor(data.segs.props(ii).BoundingBox(2));
0091         yymax = yymin + floor(data.segs.props(ii).BoundingBox(4));
0092         xxmin = floor(data.segs.props(ii).BoundingBox(1));
0093         xxmax = xxmin + floor(data.segs.props(ii).BoundingBox(3));
0094         
0095         <span class="keyword">if</span> data.segs.score(ii)
0096             
0097             data.segs.score(ii) = 0;
0098             data.segs.segs_good(yymin:yymax, xxmin:xxmax) <span class="keyword">...</span>
0099                 = double(~~(data.segs.segs_good(yymin:yymax, xxmin:xxmax)<span class="keyword">...</span>
0100                 - double(data.segs.segs_label(yymin:yymax, xxmin:xxmax)==ii)));
0101             data.segs.segs_bad(yymin:yymax, xxmin:xxmax) = <span class="keyword">...</span>
0102                 double(~~(data.segs.segs_bad(yymin:yymax, xxmin:xxmax)<span class="keyword">...</span>
0103                 +double(data.segs.segs_label(yymin:yymax, xxmin:xxmax)==ii)));
0104             
0105         <span class="keyword">else</span>
0106             
0107             data.segs.score(ii) = 1;
0108             data.segs.segs_good(yymin:yymax, xxmin:xxmax) = <span class="keyword">...</span>
0109                 double(~~(data.segs.segs_good(yymin:yymax, xxmin:xxmax)+<span class="keyword">...</span>
0110                 double(data.segs.segs_label(yymin:yymax, xxmin:xxmax)==ii)));
0111             data.segs.segs_bad(yymin:yymax, xxmin:xxmax) = <span class="keyword">...</span>
0112                 double(~~(data.segs.segs_bad(yymin:yymax, xxmin:xxmax)-<span class="keyword">...</span>
0113                 double(data.segs.segs_label(yymin:yymax, xxmin:xxmax)==ii)));
0114             
0115         <span class="keyword">end</span>
0116         
0117         data.mask_cell   = double((data.mask_bg - data.segs.segs_good - data.segs.segs_3n)&gt;0);
0118         touch_list = [touch_list, i];
0119         
0120     <span class="keyword">elseif</span> c(1) == <span class="string">'q'</span> <span class="comment">% quit</span>
0121         
0122         runFlag = 0  ;
0123         
0124     <span class="keyword">elseif</span> c(1) == <span class="string">'g'</span> <span class="comment">% go to frame c(2:end)</span>
0125         
0126         i = str2num(c(2:end));
0127         <span class="keyword">if</span> i&lt;1
0128             i = 1;
0129         <span class="keyword">elseif</span> i&gt; num_im
0130             i = num_im;
0131         <span class="keyword">end</span>
0132         
0133         data = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename )">loaderInternal</a>([dirname,contents(i  ).name]);
0134         data.mask_cell   = double((data.mask_bg - data.segs.segs_good - data.segs.segs_3n)&gt;0);
0135         
0136     <span class="keyword">elseif</span> c(1) == <span class="string">'s'</span> <span class="comment">% save - why is it empty?</span>
0137         
0138         
0139         
0140     <span class="keyword">elseif</span> c(1) == <span class="string">'1'</span> <span class="comment">% image mode 1</span>
0141         
0142         im_flag = 1;
0143         
0144     <span class="keyword">elseif</span> c(1) == <span class="string">'2'</span>
0145         
0146         im_flag = 2;
0147         
0148     <span class="keyword">elseif</span> c(1) == <span class="string">'3'</span>
0149         
0150         im_flag = 3;
0151         
0152     <span class="keyword">elseif</span> c(1) == <span class="string">'4'</span>
0153         
0154         im_flag = 4;
0155         
0156     <span class="keyword">elseif</span> c(1) == <span class="string">'c'</span> <span class="comment">% clear figure</span>
0157         clf;
0158     <span class="keyword">end</span>
0159     
0160     dataname=[dirname,contents(i).name];
0161     save(dataname,<span class="string">'-STRUCT'</span>,<span class="string">'data'</span>);
0162 <span class="keyword">end</span>
0163 
0164 tmp = pwd;
0165 cd(tmpdir);
0166 touch_list = unique(touch_list);
0167 
0168 <span class="keyword">end</span>
0169 
0170 <a name="_sub1" href="#_subfunctions" class="code">function data = loaderInternal( filename )</a>
0171 
0172 data = load( filename );
0173 data.segs.segs_good   = double(data.segs.segs_label&gt;0).*double(~data.mask_cell);
0174 data.segs.segs_bad   = double(data.segs.segs_label&gt;0).*data.mask_cell;
0175 
0176 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 23-Feb-2016 16:32:17 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>