<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of trackOptiCellFiles</title>
  <meta name="keywords" content="trackOptiCellFiles">
  <meta name="description" content="trackOptiCellFiles ; organizes the data into the final cell files that">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">SuperSeggerRelease</a> &gt; <a href="index.html">cell</a> &gt; trackOptiCellFiles.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for SuperSeggerRelease/cell&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>trackOptiCellFiles
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>trackOptiCellFiles ; organizes the data into the final cell files that</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function trackOptiCellFiles( dirname, dirname_cell, CONST, header, clist ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> trackOptiCellFiles ; organizes the data into the final cell files that 
 contain all the time lapse data for a single cell.
 It allows for cell gating. If a clist is passed, gate the list and then make an
 ID_LIST containing cells for which we want to generate cell files.

 INPUT : 
       dirname : xy directory
       dirname_cell : where cell files are placed, usually dirname/cell file
       CONST : segmentation cosntants
       header : is the last axis of the cell
       clist : array of cell files, can be used to generate cell files from the gated clist

 Copyright (C) 2016 Wiggins Lab 
 Unviersity of Washington, 2016
 This file is part of SuperSeggerOpti.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function data = intInitCell( data_c, ii, cellNum )</a></li><li><a href="#_sub2" class="code">function data = intUpCell( data, data_c, ii )</a></li><li><a href="#_sub3" class="code">function data = intDelCell( data, dirname, cellNum )</a></li><li><a href="#_sub4" class="code">function data = loaderInternal( filename )</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function trackOptiCellFiles( dirname, dirname_cell, CONST, header, clist )</a>
0002 <span class="comment">% trackOptiCellFiles ; organizes the data into the final cell files that</span>
0003 <span class="comment">% contain all the time lapse data for a single cell.</span>
0004 <span class="comment">% It allows for cell gating. If a clist is passed, gate the list and then make an</span>
0005 <span class="comment">% ID_LIST containing cells for which we want to generate cell files.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% INPUT :</span>
0008 <span class="comment">%       dirname : xy directory</span>
0009 <span class="comment">%       dirname_cell : where cell files are placed, usually dirname/cell file</span>
0010 <span class="comment">%       CONST : segmentation cosntants</span>
0011 <span class="comment">%       header : is the last axis of the cell</span>
0012 <span class="comment">%       clist : array of cell files, can be used to generate cell files from the gated clist</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Copyright (C) 2016 Wiggins Lab</span>
0015 <span class="comment">% Unviersity of Washington, 2016</span>
0016 <span class="comment">% This file is part of SuperSeggerOpti.</span>
0017 
0018 <span class="keyword">if</span> ~exist( <span class="string">'clist'</span>, <span class="string">'var'</span>) || isempty( clist) || isempty(clist.data)
0019     ID_LIST = [];
0020 <span class="keyword">else</span>
0021     clist = gate(clist);
0022     ID_LIST = clist.data(:,1);
0023 <span class="keyword">end</span>
0024 
0025 <span class="keyword">if</span> ~exist(<span class="string">'header'</span>)
0026     header = [];
0027 <span class="keyword">end</span>
0028 
0029 max_cell_num = 0;
0030 
0031 
0032 <span class="comment">% Set up directory etc.</span>
0033 
0034 dirseperator = filesep;
0035 
0036 <span class="keyword">if</span>(nargin&lt;1 || isempty(dirname))
0037     
0038     dirname=<span class="string">'.'</span>;
0039     dirname=[dirname,dirseperator];
0040 <span class="keyword">else</span>
0041     <span class="keyword">if</span> dirname(length(dirname))~=dirseperator
0042         dirname=[dirname,dirseperator];
0043     <span class="keyword">end</span>
0044 <span class="keyword">end</span>
0045 
0046 <span class="keyword">if</span>(nargin&lt;2 || isempty(dirname))
0047     dirname_cell = dirname;
0048 <span class="keyword">else</span>
0049     <span class="keyword">if</span> dirname(length(dirname))~=dirseperator
0050         dirname_cell=[dirname_cell,dirseperator];
0051     <span class="keyword">end</span>
0052 <span class="keyword">end</span>
0053 
0054 
0055 contents=dir([dirname <span class="string">'/*_err.mat'</span>]);
0056 
0057 <span class="comment">% check to make sure that there are err.mat files to work from. If not,</span>
0058 <span class="comment">% return.</span>
0059 <span class="keyword">if</span> isempty( contents )
0060     disp( [header, <span class="string">'trackOptiCellFiles: No error files have been found... possibly too many segs.'</span>] );
0061 <span class="keyword">else</span>
0062     num_im = length(contents);
0063     
0064     
0065     <span class="comment">% get the right number of cell malloc'd:</span>
0066     data_c    = <a href="#_sub4" class="code" title="subfunction data = loaderInternal( filename )">loaderInternal</a>([dirname,contents(end  ).name]);
0067     
0068     MAX_NUM_CELLS = max(data_c.regs.ID)+100;
0069     DA            = cell(1,MAX_NUM_CELLS);
0070     
0071     <span class="keyword">if</span> CONST.show_status
0072         h = waitbar( 0, <span class="string">'Make Cell Files.'</span>);
0073     <span class="keyword">else</span>
0074         h = [];
0075     <span class="keyword">end</span>
0076     <span class="keyword">for</span> i = 1:num_im;
0077         
0078         <span class="keyword">if</span> CONST.show_status
0079             waitbar(i/num_im,h,[<span class="string">'Make Cell Files--Frame: '</span>,num2str(i),<span class="string">'/'</span>,num2str(num_im)]);
0080         <span class="keyword">else</span>
0081             disp( [header, <span class="string">'Cell Files--Frame: '</span>,num2str(i),<span class="string">'/'</span>,num2str(num_im)] );
0082         <span class="keyword">end</span>
0083         
0084         <span class="comment">% load data</span>
0085         data_c    = <a href="#_sub4" class="code" title="subfunction data = loaderInternal( filename )">loaderInternal</a>([dirname,contents(i  ).name]);
0086         
0087         num_regs = data_c.regs.num_regs;
0088         
0089         disp( [header, <span class="string">'CellFiles: '</span>,<span class="string">'Frame: '</span>, num2str(i), <span class="string">'. max cell num: '</span>, num2str( max_cell_num ) ] );
0090         <span class="comment">%    memory</span>
0091         
0092 
0093         <span class="keyword">for</span> ii = 1:num_regs
0094             
0095             cellNum = data_c.regs.ID(ii);
0096             max_cell_num = max( [max_cell_num, cellNum] );
0097             
0098             
0099             <span class="comment">% This first line was added by nate to take care of snapshot</span>
0100             <span class="comment">% images.</span>
0101             <span class="keyword">if</span> cellNum &amp;&amp; ( isempty( ID_LIST ) || ismember( cellNum, ID_LIST ) )
0102                 <span class="keyword">if</span> data_c.regs.birthF(ii) == 1 &amp;&amp; data_c.regs.deathF(ii) == 1
0103                     DA{cellNum} = <a href="#_sub1" class="code" title="subfunction data = intInitCell( data_c, ii, cellNum )">intInitCell</a>( data_c, ii, cellNum );
0104                     DA{cellNum} = <a href="#_sub2" class="code" title="subfunction data = intUpCell( data, data_c, ii )">intUpCell</a>( DA{cellNum}, data_c, ii );
0105                     DA{cellNum} = <a href="#_sub3" class="code" title="subfunction data = intDelCell( data, dirname, cellNum )">intDelCell</a>( DA{cellNum},<span class="keyword">...</span>
0106                         dirname_cell, cellNum );
0107                     <span class="comment">% if a cell is born, initialize the structure</span>
0108                 <span class="keyword">elseif</span> data_c.regs.birthF(ii)
0109                     DA{cellNum} = <a href="#_sub1" class="code" title="subfunction data = intInitCell( data_c, ii, cellNum )">intInitCell</a>( data_c, ii, cellNum );
0110                     <span class="comment">% if a cell divides in the current frame, update</span>
0111                     <span class="comment">% the structure then delete the cell after saving</span>
0112                 <span class="keyword">elseif</span> data_c.regs.deathF(ii)
0113                     
0114                     DA{cellNum} = <a href="#_sub2" class="code" title="subfunction data = intUpCell( data, data_c, ii )">intUpCell</a>( DA{cellNum}, data_c, ii );
0115                     
0116                     <span class="comment">%</span>
0117                     <span class="comment">% add cell dist to cell structure.</span>
0118                     <span class="comment">%</span>
0119                     
0120                     <span class="comment">%                 mask_cell             = (data_c.regs.regs_label==ii);</span>
0121                     <span class="comment">%                 cell_dist             = min(dist_mask(mask_cell));</span>
0122                     <span class="comment">%                 DA{cellNum}.cell_dist = cell_dist;</span>
0123                     
0124                     DA{cellNum} = <a href="#_sub3" class="code" title="subfunction data = intDelCell( data, dirname, cellNum )">intDelCell</a>( DA{cellNum},<span class="keyword">...</span>
0125                         dirname_cell, cellNum );
0126                 <span class="comment">% else just update the cell</span>
0127                 <span class="keyword">else</span>
0128                     
0129                     DA{cellNum} = <a href="#_sub2" class="code" title="subfunction data = intUpCell( data, data_c, ii )">intUpCell</a>( DA{cellNum}, data_c, ii );
0130                 <span class="keyword">end</span>
0131             <span class="keyword">end</span>
0132             
0133         <span class="keyword">end</span>
0134         <span class="string">''</span>;
0135     <span class="keyword">end</span>
0136     
0137     
0138     <span class="comment">%% debug - added 1/26/2012 - cells without a death flag were not put into the Cell directory, fix this b/c lysed cells often fall in this category</span>
0139     <span class="keyword">for</span> ii=1:MAX_NUM_CELLS
0140        
0141         <span class="keyword">if</span> ~isempty(DA{ii})
0142             disp( [<span class="string">'Missing cell '</span>, num2str(DA{ii}.ID)] );
0143             DA{ii} = <a href="#_sub3" class="code" title="subfunction data = intDelCell( data, dirname, cellNum )">intDelCell</a>( DA{ii},<span class="keyword">...</span>
0144                         dirname_cell, ii );
0145         <span class="keyword">end</span>
0146     <span class="keyword">end</span>
0147     
0148     <span class="comment">%</span>
0149     <span class="keyword">if</span> CONST.show_status
0150         close(h);
0151     <span class="keyword">end</span>
0152 <span class="keyword">end</span>
0153 <span class="keyword">end</span>
0154 
0155 
0156 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0157 <span class="comment">%</span>
0158 <span class="comment">% intInitCell</span>
0159 <span class="comment">%</span>
0160 <span class="comment">% This function makes an array of cell structurs. Call this is the first</span>
0161 <span class="comment">% frame that a cell appears.</span>
0162 <span class="comment">%</span>
0163 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0164 <a name="_sub1" href="#_subfunctions" class="code">function data = intInitCell( data_c, ii, cellNum )</a>
0165 
0166 
0167 celld           = data_c.CellA{ii};
0168 
0169 celld.r         = data_c.regs.props(ii).Centroid;
0170 celld.error.label  = data_c.regs.error.label{ii};
0171 celld.ehist     = data_c.regs.ehist(ii);
0172 celld.contactHist     = data_c.regs.contactHist(ii);
0173 celld.stat0     = data_c.regs.stat0(ii);
0174 
0175 data.CellA      = {celld};
0176 
0177 data.death      = data_c.regs.death(ii);
0178 data.birth      = data_c.regs.birth(ii);
0179 data.divide     = data_c.regs.divide(ii);
0180 data.sisterID   = data_c.regs.sisterID(ii);
0181 data.motherID   = data_c.regs.motherID(ii);
0182 data.daughterID = data_c.regs.daughterID{ii};
0183 data.ID         = cellNum;
0184 data.neighbors  = data_c.regs.neighbors{ii};
0185 
0186 <span class="keyword">end</span>
0187 
0188 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0189 <span class="comment">%</span>
0190 <span class="comment">% inUpCell</span>
0191 <span class="comment">%</span>
0192 <span class="comment">% is called to update a cell in a frame. The cell must already exist and</span>
0193 <span class="comment">% this must be called before destroying a cell in the frame that the cell</span>
0194 <span class="comment">% divides.</span>
0195 <span class="comment">%</span>
0196 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0197 <a name="_sub2" href="#_subfunctions" class="code">function data = intUpCell( data, data_c, ii )</a>
0198 
0199 celld           = data_c.CellA{ii};
0200 
0201 celld.r         = data_c.regs.props(ii).Centroid;
0202 celld.error.label  = data_c.regs.error.label{ii};
0203 celld.ehist     = data_c.regs.ehist(ii);
0204 celld.contactHist     = data_c.regs.contactHist(ii);
0205 
0206 celld.stat0     = data_c.regs.stat0(ii);
0207 <span class="keyword">try</span>
0208     data.CellA      = {data.CellA{:},celld};
0209 <span class="keyword">catch</span>
0210     <span class="string">''</span>;
0211 <span class="keyword">end</span>
0212 data.death      = data_c.regs.death(ii);
0213 data.birth      = data_c.regs.birth(ii);
0214 data.divide     = data_c.regs.divide(ii);
0215 data.sisterID   = data_c.regs.sisterID(ii);
0216 data.motherID   = data_c.regs.motherID(ii);
0217 data.daughterID = data_c.regs.daughterID{ii};
0218 data.neighbors  = data_c.regs.neighbors{ii};
0219 
0220 <span class="keyword">end</span>
0221 
0222 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0223 <span class="comment">%</span>
0224 <span class="comment">% inDelCell</span>
0225 <span class="comment">%</span>
0226 <span class="comment">% is evaluated when you want to destroy a cell on division to liberate the</span>
0227 <span class="comment">% memory and save the cell file.</span>
0228 <span class="comment">%</span>
0229 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0230 <a name="_sub3" href="#_subfunctions" class="code">function data = intDelCell( data, dirname, cellNum )</a>
0231 
0232 data.stat0 = data.CellA{end}.stat0;
0233 data.ehist = data.CellA{end}.ehist;
0234 data.contactHist = data.CellA{end}.contactHist;
0235 
0236 <span class="keyword">if</span> dirname(end) ~= filesep
0237     dirname = [dirname,filesep];
0238 <span class="keyword">end</span>
0239 
0240 <span class="keyword">if</span> data.stat0 == 2;
0241     <span class="comment">% Then this is a good cell.</span>
0242     dataname=[dirname,<span class="string">'Cell'</span>,sprintf( <span class="string">'%07d'</span>, cellNum ),<span class="string">'.mat'</span>];
0243 <span class="keyword">else</span>
0244     dataname=[dirname,<span class="string">'cell'</span>,sprintf( <span class="string">'%07d'</span>, cellNum ),<span class="string">'.mat'</span>];
0245 <span class="keyword">end</span>
0246 save(dataname,<span class="string">'-STRUCT'</span>,<span class="string">'data'</span>);
0247 data = [];
0248 
0249 <span class="keyword">end</span>
0250 
0251 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0252 <span class="comment">%</span>
0253 <span class="comment">% loaderInternal</span>
0254 <span class="comment">%</span>
0255 <span class="comment">% standard internal loader function... but in this case we just load the</span>
0256 <span class="comment">% file.</span>
0257 <span class="comment">%</span>
0258 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0259 <a name="_sub4" href="#_subfunctions" class="code">function data = loaderInternal( filename )</a>
0260 data = load( filename );
0261 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 23-Feb-2016 16:32:17 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>