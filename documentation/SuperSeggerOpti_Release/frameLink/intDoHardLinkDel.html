<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of intDoHardLinkDel</title>
  <meta name="keywords" content="intDoHardLinkDel">
  <meta name="description" content="intDoHardLinkDel : hard links the regions that uniquely overlap.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">SuperSeggerOpti_Release</a> &gt; <a href="index.html">frameLink</a> &gt; intDoHardLinkDel.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for SuperSeggerOpti_Release/frameLink&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>intDoHardLinkDel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>intDoHardLinkDel : hard links the regions that uniquely overlap.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [map, XX] = intDoHardLinkDel( map, XX, DA, CONST ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> intDoHardLinkDel : hard links the regions that uniquely overlap.
 if one of the regions maps uniquely to a region, and none of the
 others do, it hard maps the region.

 INPUT :
       map: contains region numbers for mapping in the order of amount of overlap 
       XX :
       DA :
       CONST :  Segmentation Constants
 OUTPUT :
       map : new region mappings
       XX :

 Copyright (C) 2016 Wiggins Lab
 University of Washington, 2016
 This file is part of SuperSeggerOpti.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="calcRegsInt.html" class="code" title="function [XX,map,error,dA,DA,dF1,dF2,dF1b,dF2b,mapOld,XXOld,dAOld]= calcRegsInt( data1, data2, CONST )">calcRegsInt</a>	calcRegsInt : calculates the max overlap between data1 and data2 regions</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [map, XX] = intDoHardLinkDel( map, XX, DA, CONST )</a>
0002 <span class="comment">% intDoHardLinkDel : hard links the regions that uniquely overlap.</span>
0003 <span class="comment">% if one of the regions maps uniquely to a region, and none of the</span>
0004 <span class="comment">% others do, it hard maps the region.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% INPUT :</span>
0007 <span class="comment">%       map: contains region numbers for mapping in the order of amount of overlap</span>
0008 <span class="comment">%       XX :</span>
0009 <span class="comment">%       DA :</span>
0010 <span class="comment">%       CONST :  Segmentation Constants</span>
0011 <span class="comment">% OUTPUT :</span>
0012 <span class="comment">%       map : new region mappings</span>
0013 <span class="comment">%       XX :</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Copyright (C) 2016 Wiggins Lab</span>
0016 <span class="comment">% University of Washington, 2016</span>
0017 <span class="comment">% This file is part of SuperSeggerOpti.</span>
0018 
0019 DA_MIN            = CONST.trackOpti.DA_MIN;
0020 DA_MAX            = CONST.trackOpti.DA_MAX;
0021 
0022 area_logic = and(DA &gt; DA_MIN, DA &lt; DA_MAX );
0023 
0024 ind_c      = find( area_logic );
0025 ind_r      = drill( map(ind_c), <span class="string">'(1)'</span> );
0026 
0027 <span class="comment">% keep only ind_c/ind_r that map to regions in r</span>
0028 map_ind_r_log = (ind_r&gt;0);
0029 ind_c0      = ind_c(map_ind_r_log);
0030 ind_r0      = ind_r(map_ind_r_log);
0031 
0032 <span class="comment">% make a protected list of regions that cannot be hard linked.</span>
0033 nMap = numel(map);
0034 ind_r_pro = zeros(1,nMap);
0035 ind_c_pro = zeros(1,nMap);
0036 npro = 0;
0037 
0038 <span class="keyword">for</span> ii = 1:nMap
0039     <span class="comment">% don't subtract if it is already in the list</span>
0040     <span class="keyword">if</span> (numel(map{ii}) == 1) &amp;&amp; ~area_logic(ii)
0041        npro = npro + 1;
0042        ind_r_pro(npro) = map{ii};
0043        ind_c_pro(npro) = ii;
0044     <span class="keyword">end</span>
0045 <span class="keyword">end</span>
0046 ind_r_pro = ind_r_pro(1:npro);
0047 ind_c_pro = ind_c_pro(1:npro);
0048 
0049 <span class="comment">% remove protected indices</span>
0050 include_ind = ~ismember( ind_r0, ind_r_pro );
0051 ind_c = ind_c0(include_ind);
0052 ind_r = ind_r0(include_ind);
0053 
0054 <span class="comment">% make a list of unique r regions</span>
0055 [ind_r_unique,ind_ind_r_first,c1] = unique( ind_r,<span class="string">'first'</span> );
0056 [ind_r_unique,ind_ind_r_last, c2] = unique( ind_r,<span class="string">'last'</span>  );
0057 
0058 <span class="comment">% ind_c_hard corresponds to the list for mapped c regions. Initially just</span>
0059 <span class="comment">% set it equal to the first occurance of the region r in the map.</span>
0060 ind_c_hard    = ind_c(ind_ind_r_first);
0061 
0062 <span class="comment">% make a list of r regions that are repeated. If they are repeated, the</span>
0063 <span class="comment">% first and last instance will not be equal.</span>
0064 repeated_ind_r   = ind_r_unique(ind_ind_r_first~=ind_ind_r_last);
0065 
0066 <span class="comment">% if two regions in the current frame map with no area change to the</span>
0067 <span class="comment">% reverse frame, (i) first check to see if one of those cells</span>
0068 <span class="comment">% only maps to a single cell.</span>
0069 nrr = numel( repeated_ind_r );
0070 
0071 <span class="comment">% make a new version of repeated_ind_r to remove elements from.</span>
0072 list_remove = [];
0073 <span class="keyword">for</span> ii = 1:nrr
0074    <span class="comment">% get all the c region numbers that map to repeated_ind_r(ii)</span>
0075    ind_c_m = ind_c(find( repeated_ind_r(ii) == ind_r ));
0076    
0077    <span class="comment">% find the index of this r region in the list of unique r regions</span>
0078    ind_ind_r_unique = find( repeated_ind_r(ii) == ind_r_unique);
0079    
0080    <span class="comment">% make a list of the number of r regions that each c region maps to.</span>
0081    nn = [];
0082    <span class="keyword">for</span> jj = ind_c_m
0083        nn = [nn, numel(map{jj})];
0084    <span class="keyword">end</span>
0085    
0086    <span class="comment">% sort this list so that the smallest number of mapped regions occur and</span>
0087    <span class="comment">% the beginning of the list</span>
0088    [nn,ord] = sort( nn, <span class="string">'ascend'</span> );
0089    
0090    <span class="comment">% if one of the c regions maps uniquely to this region, but none of the</span>
0091    <span class="comment">% others do, hard map the c and r regions. if not, do nothing.</span>
0092    <span class="keyword">if</span> (nn(1) == 1) &amp;&amp; (nn(2) ~= 1)
0093         
0094         ind_c_hard(ind_ind_r_unique) = ind_c_m(ord(1));
0095         
0096         <span class="comment">% remove this r region from the list of repeated r regions</span>
0097         list_remove = [list_remove, repeated_ind_r(ii)];
0098    <span class="keyword">end</span>
0099 <span class="keyword">end</span>
0100 
0101 <span class="comment">% reset repeated_ind_r to the shortened version</span>
0102 repeated_ind_r = repeated_ind_r( ~ismember(repeated_ind_r, list_remove));
0103 
0104 <span class="comment">% (ii) choose the one that has the best overlap.</span>
0105 nrr = numel( repeated_ind_r );
0106 <span class="keyword">for</span> ii = 1:nrr
0107     
0108    <span class="comment">% get all the c region numbers that map to repeated_ind_r(ii)</span>
0109    ind_c_m = ind_c(find( repeated_ind_r(ii) == ind_r ));
0110    
0111    <span class="comment">% find the index of this r region in the list of unique r regions</span>
0112    ind_ind_r_unique = find( repeated_ind_r(ii) == ind_r_unique );
0113    
0114     <span class="comment">% find the ind of ind_ind_c_m with the highest overlap</span>
0115    [max_overlap, ind_ind_c_m] = max( drill(XX(1,ind_c_m),<span class="string">'(1)'</span>) );
0116    
0117    ind_c_hard(ind_ind_r_unique) = ind_c_m(ind_ind_c_m);
0118 <span class="keyword">end</span>
0119 
0120 
0121 <span class="comment">% first remove all the links to r regions that have been given a hard link</span>
0122 <span class="comment">% to another c region</span>
0123 nMap = numel( map );
0124 <span class="keyword">for</span> ii = 1:nMap
0125 
0126     ind = ~ismember( map{ii}, ind_r_unique(ii~=ind_c_hard));
0127     map{ii} = map{ii}(ind);
0128     XX{ii}  = XX{ii}(:,ind);
0129 <span class="keyword">end</span>
0130 
0131 
0132 <span class="comment">% Then set the hard links to only link to one cell.</span>
0133 nindchard = numel( ind_c_hard );
0134 <span class="keyword">for</span> jj = 1:nindchard    
0135     ii = ind_c_hard(jj);
0136     ind_map = find(map{ii}==ind_r_unique(jj));    
0137     map{ii} = ind_r_unique(jj);
0138     XX{ii}  = XX{ii}(:,ind_map);
0139 <span class="keyword">end</span>
0140 
0141 
0142 <span class="keyword">end</span>
0143</pre></div>
<hr><address>Generated on Tue 23-Feb-2016 13:44:44 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>