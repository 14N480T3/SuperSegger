<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of trackOptiView</title>
  <meta name="keywords" content="trackOptiView">
  <meta name="description" content="trackOptiView provides visulization of the segmented data.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">SuperSeggerOpti_Release</a> &gt; <a href="index.html">viz</a> &gt; trackOptiView.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for SuperSeggerOpti_Release/viz&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>trackOptiView
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>trackOptiView provides visulization of the segmented data.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function trackOptiView(dirname,file_filter,err_flag) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> trackOptiView provides visulization of the segmented data.

 It has a lot of options such as :
 f : Toggle between phase and fluorescence view
 x# :  Switch xy dir # 
 t  : Show Cell Numbers 
 r  : Show/Hide Region Outlines
 o  : Show Consensus   
 K  : Kymograph Mosaic 
 h# : Tower for Cell #  
 g  : Make Gate  
 Clear : Clear all Gates
 c  : Reset Plot to Default View'
 s  : Show Fluor Foci     
 #  : Go to Frame Number #
 CC : Use Complete Cell Cycles
 F : Find Cell Number #  
 p  : Show/Hide Cell Poles 
 H# : Show Kymograph for Cell #
 Z  : Cell Towers Mosaic      
 G  : Gate All Cell Files       
 Movie : Export Movie Frames   
 
 INPUT :
       dirname : directory that contains file segemented by supeSegger
       file_filter :
       err_flag :

 Copyright (C) 2016 Wiggins Lab 
 University of Washington, 2016
 This file is part of SuperSeggerOpti.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="makeConsIm.html" class="code" title="function [ imMosaic, imColor, imBW, imInv, kymo, kymoMask, I,kymoMax, kymoMaskMax, imMosaic10, imBWunmasked, imBWmask, hotPix,AA, BB ] = makeConsIm( dirName, CONST, skip, mag, disp_flag )">makeConsIm</a>	makeConsIm Computes consensus fluorescence localization from cells in a cell files</li><li><a href="makeFrameMosaic.html" class="code" title="function [im] = makeFrameMosaic( data, CONST, xdim, disp_flag, skip )">makeFrameMosaic</a>	</li><li><a href="makeFrameStripeMosaic.html" class="code" title="function [imTot] = makeFrameStripeMosaic( dirName, CONST, ll_, disp_flag )">makeFrameStripeMosaic</a>	</li><li><a href="makeKymoMosaic.html" class="code" title="function makeKymoMosaic( dirname, CONST );">makeKymoMosaic</a>	</li><li><a href="makeKymographC.html" class="code" title="function [Kymo,ll1,f1mm,f2mm] = makeKymographC( data, disp_flag, CONST );">makeKymographC</a>	</li><li><a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>	Copyright (C) 2016 Wiggins Lab</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function data = loaderInternal( filename, clist )</a></li><li><a href="#_sub2" class="code">function [nameInfo] = getDirStruct( dirname )</a></li><li><a href="#_sub3" class="code">function padStr = getPadSize( dirname )</a></li><li><a href="#_sub4" class="code">function ixy = intGetNum( str_xy )</a></li><li><a href="#_sub5" class="code">function [data_r, data_c, data_f] = intLoadData( dirname,</a></li><li><a href="#_sub6" class="code">function val = AD_FLAG()</a></li><li><a href="#_sub7" class="code">function val = SD_FLAG()</a></li><li><a href="#_sub8" class="code">function val = ND_FLAG()</a></li><li><a href="#_sub9" class="code">function intDispError( data_c, FLAGS )</a></li><li><a href="#_sub10" class="code">function FLAGS = intSetDefaultFlags()</a></li><li><a href="#_sub11" class="code">function intCons(dirname0, contents_xy, dircons, setHeader, CONST)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function trackOptiView(dirname,file_filter,err_flag)</a>
0002 <span class="comment">% trackOptiView provides visulization of the segmented data.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% It has a lot of options such as :</span>
0005 <span class="comment">% f : Toggle between phase and fluorescence view</span>
0006 <span class="comment">% x# :  Switch xy dir #</span>
0007 <span class="comment">% t  : Show Cell Numbers</span>
0008 <span class="comment">% r  : Show/Hide Region Outlines</span>
0009 <span class="comment">% o  : Show Consensus</span>
0010 <span class="comment">% K  : Kymograph Mosaic</span>
0011 <span class="comment">% h# : Tower for Cell #</span>
0012 <span class="comment">% g  : Make Gate</span>
0013 <span class="comment">% Clear : Clear all Gates</span>
0014 <span class="comment">% c  : Reset Plot to Default View'</span>
0015 <span class="comment">% s  : Show Fluor Foci</span>
0016 <span class="comment">% #  : Go to Frame Number #</span>
0017 <span class="comment">% CC : Use Complete Cell Cycles</span>
0018 <span class="comment">% F : Find Cell Number #</span>
0019 <span class="comment">% p  : Show/Hide Cell Poles</span>
0020 <span class="comment">% H# : Show Kymograph for Cell #</span>
0021 <span class="comment">% Z  : Cell Towers Mosaic</span>
0022 <span class="comment">% G  : Gate All Cell Files</span>
0023 <span class="comment">% Movie : Export Movie Frames</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% INPUT :</span>
0026 <span class="comment">%       dirname : directory that contains file segemented by supeSegger</span>
0027 <span class="comment">%       file_filter :</span>
0028 <span class="comment">%       err_flag :</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% Copyright (C) 2016 Wiggins Lab</span>
0031 <span class="comment">% University of Washington, 2016</span>
0032 <span class="comment">% This file is part of SuperSeggerOpti.</span>
0033 
0034 <span class="comment">%% Load Constants and Initialize Flags</span>
0035 
0036 hf = figure(1);
0037 clf;
0038 <span class="comment">%set( hf, 'Color', [0.1,0.1,0.1] );</span>
0039 
0040 mov = struct;
0041 CONST = [];
0042 touch_list = [];
0043 
0044 
0045 <span class="keyword">if</span> nargin&lt;2 || isempty(file_filter);
0046     file_filter = <span class="string">'*err.mat'</span>;
0047 <span class="keyword">end</span>
0048 
0049 <span class="keyword">if</span> nargin&lt;3 || isempty(err_flag);
0050     err_flag = 1;
0051 <span class="keyword">end</span>
0052 
0053 FLAGS.err_flag = err_flag;
0054 
0055 
0056 <span class="keyword">if</span> ~exist(<span class="string">'strip_flag'</span>);
0057     strip_flag = 1;
0058 <span class="keyword">end</span>
0059 
0060 <span class="comment">% Add slash to the file name if it doesn't exist</span>
0061 <span class="keyword">if</span>(nargin&lt;1 || isempty(dirname))
0062     
0063     dirname=uigetdir()
0064     dirname=[dirname,filesep];
0065 <span class="keyword">else</span>
0066     <span class="keyword">if</span> dirname(end)~=filesep
0067         dirname=[dirname,filesep];
0068     <span class="keyword">end</span>
0069 <span class="keyword">end</span>
0070 
0071 D_FLAG = [];
0072 
0073 n_char    = numel(dirname);
0074 seg_pos   = strfind( dirname, [<span class="string">'seg'</span>,filesep]);
0075 
0076 <span class="keyword">if</span> (n_char - seg_pos) == (numel([<span class="string">'seg'</span>,filesep])-1)
0077     disp( <span class="string">'seg mode'</span> );
0078     D_FLAG = <a href="#_sub7" class="code" title="subfunction val = SD_FLAG()">SD_FLAG</a>;
0079 <span class="keyword">else</span>
0080     <span class="keyword">if</span> exist( [dirname,filesep,<span class="string">'raw_im'</span>],<span class="string">'dir'</span>)
0081         D_FLAG = <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>;
0082     <span class="keyword">else</span>
0083         D_FLAG = <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>;
0084     <span class="keyword">end</span>
0085 <span class="keyword">end</span>
0086 
0087 dirname0 = dirname;
0088 
0089 
0090 <span class="comment">% load flags if they already exist to maintain state between launches</span>
0091 filename_flags = [dirname0,<span class="string">'.trackOptiView.mat'</span>];
0092 <span class="keyword">if</span>  (D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>) &amp;&amp; exist( filename_flags, <span class="string">'file'</span> )
0093     load(filename_flags);
0094 <span class="keyword">else</span>
0095     FLAGS = <a href="#_sub10" class="code" title="subfunction FLAGS = intSetDefaultFlags()">intSetDefaultFlags</a>();
0096     
0097     error_list = [];
0098     nn = 1;
0099     dirnum = 1;
0100 <span class="keyword">end</span>
0101 
0102 contents = [];
0103 
0104 <span class="comment">% Load info from one of the xy directories. dirnum tells you which one. If</span>
0105 <span class="comment">% you quit the program in an xy dir, it goes to that xy dir.</span>
0106 clist = [];
0107 <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0108     contents_xy =dir([dirname, <span class="string">'xy*'</span>]);
0109     
0110     <span class="comment">% Load up the aska set name from the file header.mat</span>
0111     setHeaderFileName = [dirname,<span class="string">'header.mat'</span>];
0112     <span class="keyword">if</span> exist( setHeaderFileName, <span class="string">'file'</span> );
0113         setHeader = load( setHeaderFileName );
0114         setHeader = setHeader.header;
0115     <span class="keyword">else</span>
0116         setHeader = [];
0117     <span class="keyword">end</span>
0118     
0119     <span class="keyword">try</span>
0120         dircons = [dirname0,<span class="string">'consensus'</span>,filesep];
0121         mkdir( dircons );
0122     <span class="keyword">end</span>
0123     
0124     num_xy = numel(contents_xy);
0125     <span class="keyword">if</span> ~num_xy
0126         disp(<span class="string">'no xy dirs'</span>);
0127         <span class="keyword">return</span>;
0128     <span class="keyword">else</span>
0129         <span class="keyword">if</span> isdir([dirname0,contents_xy(dirnum).name,filesep,<span class="string">'seg_full'</span>])
0130             dirname = [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'seg_full'</span>,filesep];
0131         <span class="keyword">else</span>
0132             dirname = [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'seg'</span>,filesep];
0133         <span class="keyword">end</span>
0134         
0135         dirname_cell = [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'cell'</span>,filesep];
0136         dirname_xy = [dirname0,contents_xy(dirnum).name,filesep];
0137         
0138         <span class="comment">% Open clist if it exists</span>
0139         clist_name = [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'clist.mat'</span>];
0140         <span class="keyword">if</span> exist( clist_name, <span class="string">'file'</span> )
0141             clist = load([dirname0,contents_xy(dirnum).name,filesep,<span class="string">'clist.mat'</span>]);
0142         <span class="keyword">else</span>
0143             clist = [];
0144         <span class="keyword">end</span>
0145         
0146         ixy = <a href="#_sub4" class="code" title="subfunction ixy = intGetNum( str_xy )">intGetNum</a>( contents_xy(dirnum).name );
0147         header = [<span class="string">'xy'</span>,num2str(ixy),<span class="string">': '</span>];
0148         
0149     <span class="keyword">end</span>
0150     nameInfo = [];
0151 <span class="keyword">elseif</span> D_FLAG == <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>
0152     [nameInfo] = <a href="#_sub2" class="code" title="subfunction [nameInfo] = getDirStruct( dirname )">getDirStruct</a>( dirname0 );
0153     num_xy = numel(nameInfo.nxy);
0154     header = [<span class="string">'xy'</span>,num2str(dirnum),<span class="string">': '</span>];
0155     
0156 <span class="keyword">end</span>
0157 
0158 
0159 FLAGS.D_flag  = D_FLAG;
0160 
0161 <span class="keyword">if</span> (D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>) || (D_FLAG == <a href="#_sub7" class="code" title="subfunction val = SD_FLAG()">SD_FLAG</a>)
0162     contents=dir([dirname, file_filter]);
0163     num_im = length(contents);
0164 <span class="keyword">else</span>
0165     num_im = numel(nameInfo.nt);
0166 <span class="keyword">end</span>
0167 
0168 
0169 <span class="keyword">try</span>
0170     CONST = load([dirname0,<span class="string">'CONST.mat'</span>]);
0171     <span class="keyword">if</span> isfield( CONST, <span class="string">'CONST'</span> )
0172         CONST = CONST.CONST;
0173     <span class="keyword">end</span>
0174 <span class="keyword">catch</span>
0175     disp([<span class="string">'Exiting. Can''t load CONST file. Make sure there is a CONST.mat file at the root'</span>, <span class="keyword">...</span>
0176         <span class="string">'level of the data directory.'</span>]);
0177     <span class="keyword">return</span>
0178 <span class="keyword">end</span>
0179 
0180 <span class="keyword">if</span> nn &gt; num_im
0181     nn = num_im;
0182 <span class="keyword">end</span>
0183 
0184 
0185 runFlag = (nn&lt;=num_im);
0186 first_flag = 1;
0187 
0188 <span class="comment">% This flag controls whether you reload from file</span>
0189 resetFlag = true;
0190 
0191 FLAGS.e_flag = 0 ;
0192 
0193 <span class="comment">%% Run the main loop... and run it while the runFlag is true.</span>
0194 <span class="keyword">while</span> runFlag
0195     
0196     <span class="comment">% load current frame</span>
0197     <span class="keyword">if</span> resetFlag
0198         resetFlag = false;
0199         <span class="comment">%tic</span>
0200         [data_r, data_c, data_f] = <a href="#_sub5" class="code" title="subfunction [data_r, data_c, data_f] = intLoadData( dirname, ">intLoadData</a>( dirname, <span class="keyword">...</span>
0201             D_FLAG, contents, nn, num_im, nameInfo, clist, dirnum);
0202         <span class="comment">%toc</span>
0203     <span class="keyword">end</span>
0204     
0205     <span class="keyword">if</span> ~first_flag
0206         tmp_axis = axis;
0207     <span class="keyword">else</span>
0208         <span class="keyword">try</span>
0209             imshow( data_c.phase );
0210         <span class="keyword">end</span>
0211         
0212     <span class="keyword">end</span>
0213     
0214     <span class="comment">%tic</span>
0215     <span class="comment">%try</span>
0216     <a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>( data_c, data_r, data_f, FLAGS, clist, CONST);
0217     <span class="comment">%toc</span>
0218     <span class="comment">%end</span>
0219     
0220     <span class="keyword">if</span> FLAGS.c_flag &amp;&amp; ~first_flag
0221         axis( tmp_axis );
0222     <span class="keyword">end</span>
0223     first_flag = false;
0224     
0225     
0226     
0227     <span class="comment">% Main Menu</span>
0228     disp(<span class="string">'-----------------------------------------------------------'</span>);
0229     disp(<span class="string">'SuperSegger Data Viewer'</span>);
0230     disp(<span class="string">' '</span>);
0231     disp(<span class="string">'q  : To quit                    c  : Reset Plot to Default View'</span>);
0232     disp(<span class="string">'f  : Toggle Phase/Fluor         s  : Show Fluor Foci           '</span>);
0233     disp(<span class="string">'x# : Switch xy dir #            #  : Go to Frame Number #      '</span>);
0234     disp(<span class="string">'t  : Show Cell Numbers          CC : Use Complete Cell Cycles '</span>);
0235     disp(<span class="string">'r  : Show/Hide Region Outlines  F# : Find Cell Number #       '</span>);
0236     disp(<span class="string">'o  : Show Consensus             p  : Show/Hide Cell Poles      '</span>);
0237     disp(<span class="string">'K  : Kymograph Mosaic           H# : Show Kymograph for Cell #'</span>);
0238     disp(<span class="string">'h# : Tower for Cell #           Z  : Cell Towers Mosaic        '</span>);
0239     disp(<span class="string">'g  : Make Gate                  G  : Gate All Cell Files       '</span>);
0240     disp(<span class="string">'Clear : Clear all Gates         Movie : Export Movie Frames   '</span>);
0241     disp(<span class="string">' '</span>);
0242     disp(<span class="string">'              k : Enter debugging mode                      '</span>);
0243     disp(<span class="string">'-----------------------------------------------------------'</span>)
0244     disp(<span class="string">' '</span>);
0245     
0246     <span class="comment">% if you loaded segmented data</span>
0247     <span class="keyword">if</span> D_FLAG ~= <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>
0248         <span class="comment">% show the master error list.</span>
0249         <span class="keyword">if</span> FLAGS.err_flag
0250             <span class="keyword">if</span> isempty(error_list)
0251                 error_list = trackOptiGetErrorListDisk( dirname, [] );
0252             <span class="keyword">end</span>
0253             disp(error_list);
0254         <span class="keyword">end</span>
0255         <span class="comment">% show errors in this frame.</span>
0256         <span class="keyword">if</span> FLAGS.e_flag
0257             <a href="#_sub9" class="code" title="subfunction intDispError( data_c, FLAGS )">intDispError</a>( data_c, FLAGS );
0258         <span class="keyword">end</span>
0259     <span class="keyword">end</span>
0260     
0261     <span class="keyword">if</span> ~isempty( touch_list );
0262         disp(<span class="string">'Warning! Frames touched. Run re-link.'</span>);
0263         touch_list
0264     <span class="keyword">end</span>
0265     
0266     
0267     disp([header, <span class="string">'Frame num [1...'</span>,num2str(num_im),<span class="string">']: '</span>,num2str(nn)]);
0268     
0269     c = input(<span class="string">':'</span>,<span class="string">'s'</span>)
0270     
0271     
0272     <span class="keyword">if</span> isempty(c)
0273         
0274         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0275         <span class="comment">%</span>
0276         <span class="comment">% LIST OF COMMANDS</span>
0277         <span class="comment">%</span>
0278         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0279         
0280         <span class="comment">% Quit Command</span>
0281     <span class="keyword">elseif</span> c(1) == <span class="string">'q'</span>
0282         <span class="comment">% This is the quit command</span>
0283         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0284             <span class="keyword">try</span>
0285                 save( [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'clist.mat'</span>],<span class="string">'-STRUCT'</span>,<span class="string">'clist'</span>);
0286             <span class="keyword">catch</span>
0287                 disp(<span class="string">'Error saving clist file.'</span>);
0288             <span class="keyword">end</span>
0289         <span class="keyword">end</span>
0290         runFlag = 0  ;
0291         
0292         <span class="comment">% Toggle Between Full Cell Cycles</span>
0293     <span class="keyword">elseif</span> strcmp(c,<span class="string">'CC'</span>)
0294         CONST.view.showFullCellCycleOnly = ~CONST.view.showFullCellCycleOnly ;
0295         <span class="keyword">if</span> CONST.view.showFullCellCycleOnly
0296             disp(<span class="string">'Only including complete Cell Cycles (press any key)'</span>)
0297             pause
0298         <span class="keyword">else</span>
0299             disp(<span class="string">'Including Incomplete Cell Cycles (press any key)'</span>)
0300             pause
0301         <span class="keyword">end</span>
0302         
0303         
0304         
0305         
0306         <span class="comment">% Find Single Cells</span>
0307     <span class="keyword">elseif</span> c(1) == <span class="string">'F'</span>
0308         
0309         <span class="keyword">if</span> numel(c) &gt; 1
0310             find_num = floor(str2num(c(2:end)));
0311             
0312             <span class="keyword">if</span> FLAGS.v_flag
0313                 regnum = find( data_c.regs.ID == find_num);
0314                 
0315                 <span class="keyword">if</span> ~isempty( regnum )
0316                     plot(data_c.CellA{regnum}.coord.r_center(1),<span class="keyword">...</span>
0317                         data_c.CellA{regnum}.coord.r_center(2), <span class="keyword">...</span>
0318                         <span class="string">'yx'</span>,<span class="string">'MarkerSize'</span>,100);
0319                 <span class="keyword">else</span>
0320                     disp(<span class="string">'coundt fidn that cell'</span>);
0321                 <span class="keyword">end</span>
0322                 
0323             <span class="keyword">else</span>
0324                 <span class="keyword">if</span> (find_num &lt;= data_c.regs.num_regs) &amp;&amp; (find_num &gt;0)
0325                     plot(data_c.CellA{find_num}.coord.r_center(1),<span class="keyword">...</span>
0326                         data_c.CellA{find_num}.coord.r_center(2), <span class="keyword">...</span>
0327                         <span class="string">'yx'</span>,<span class="string">'MarkerSize'</span>,100);
0328                 <span class="keyword">else</span>
0329                     disp( <span class="string">'Out of range'</span> );
0330                 <span class="keyword">end</span>
0331             <span class="keyword">end</span>
0332             
0333             input(<span class="string">'Press any key'</span>,<span class="string">'s'</span>);
0334             
0335         <span class="keyword">end</span>
0336         
0337         <span class="comment">% Change xy positions</span>
0338     <span class="keyword">elseif</span> c(1) == <span class="string">'x'</span>
0339         <span class="keyword">if</span> D_FLAG ~= <a href="#_sub7" class="code" title="subfunction val = SD_FLAG()">SD_FLAG</a>
0340             
0341             <span class="keyword">if</span> numel(c)&gt;1
0342                 c = c(2:end);
0343             <span class="keyword">else</span>
0344                 <span class="keyword">for</span> ll = 1:num_xy
0345                     <span class="keyword">if</span> D_FLAG ~= <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>
0346                         disp( [num2str(ll),<span class="string">': '</span>,contents_xy(ll).name] );
0347                     <span class="keyword">else</span>
0348                         disp( [num2str(ll),<span class="string">': xy'</span>,num2str(nameInfo.nxy(ll))] );
0349                     <span class="keyword">end</span>
0350                 <span class="keyword">end</span>
0351                 c = input(<span class="string">':'</span>,<span class="string">'s'</span>)
0352             <span class="keyword">end</span>
0353             ll_ = floor(str2num(c));
0354             
0355             <span class="keyword">if</span> ~isempty(ll_) &amp;&amp; (ll_&gt;=1) &amp;&amp; (ll_&lt;=num_xy)
0356                 <span class="keyword">if</span> D_FLAG ~= <a href="#_sub8" class="code" title="subfunction val = ND_FLAG()">ND_FLAG</a>
0357                     
0358                     
0359                     <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0360                         <span class="keyword">try</span>
0361                             save( [dirname0,contents_xy(dirnum).name,filesep,<span class="string">'clist.mat'</span>],<span class="string">'-STRUCT'</span>,<span class="string">'clist'</span>);
0362                         <span class="keyword">catch</span>
0363                             disp( <span class="string">'Error writing clist file.'</span>);
0364                         <span class="keyword">end</span>
0365                     <span class="keyword">end</span>
0366                     
0367                     dirnum = ll_;
0368                     
0369                     <span class="keyword">if</span> isdir([dirname0,contents_xy(dirnum).name,filesep,<span class="string">'seg_full'</span>])
0370                         dirname = [dirname0,contents_xy(ll_).name,filesep,<span class="string">'seg_full'</span>,filesep];
0371                     <span class="keyword">else</span>
0372                         dirname = [dirname0,contents_xy(ll_).name,filesep,<span class="string">'seg'</span>,filesep];
0373                     <span class="keyword">end</span>
0374                     
0375                     dirname_cell = [dirname0,contents_xy(ll_).name,filesep,<span class="string">'cell'</span>,filesep];
0376                     dirname_xy = [dirname0,contents_xy(ll_).name,filesep];
0377                     
0378                     ixy = <a href="#_sub4" class="code" title="subfunction ixy = intGetNum( str_xy )">intGetNum</a>( contents_xy(dirnum).name );
0379                     header = [<span class="string">'xy'</span>,num2str(ixy),<span class="string">': '</span>];
0380                     
0381                     contents=dir([dirname, file_filter]);
0382                     error_list = [];
0383                     
0384                     
0385                     clist = load([dirname0,contents_xy(ll_).name,filesep,<span class="string">'clist.mat'</span>]);
0386                 <span class="keyword">else</span>
0387                     dirnum = nameInfo.nxy(ll_);
0388                     header = [<span class="string">'xy'</span>,num2str(dirnum),<span class="string">': '</span>];
0389                     
0390                 <span class="keyword">end</span>
0391             <span class="keyword">end</span>
0392             resetFlag = true;
0393         <span class="keyword">else</span>
0394             disp( <span class="string">'Not supported in this mode.'</span> );
0395         <span class="keyword">end</span>
0396         
0397         <span class="comment">% Show/Hide Region Outlines</span>
0398     <span class="keyword">elseif</span> c(1) == <span class="string">'r'</span>
0399         FLAGS.P_flag = ~FLAGS.P_flag;
0400         
0401         <span class="comment">% Reset Plot to Default View</span>
0402     <span class="keyword">elseif</span> strcmp(c,<span class="string">'c'</span>)
0403         FLAGS.c_flag = ~FLAGS.c_flag;
0404         clf;
0405         first_flag = 1;
0406         
0407         <span class="comment">% Toggle Between Fluorescence and Phase Images</span>
0408     <span class="keyword">elseif</span> c(1) == <span class="string">'f'</span>
0409         FLAGS.f_flag = ~FLAGS.f_flag;
0410         
0411         <span class="comment">% Gate Cells</span>
0412     <span class="keyword">elseif</span> c(1) == <span class="string">'g'</span>
0413         
0414         disp(<span class="string">'Choose gating characteristic'</span>)
0415         disp(clist.def')
0416         cc = input(<span class="string">'Gate Number(s) [ ] :'</span>,<span class="string">'s'</span>) ;
0417         tmp_clist = gateMake(clist,str2num(cc)) ;
0418         
0419         clist = tmp_clist ;
0420         clf;
0421         first_flag = 1;
0422         
0423         <span class="comment">% Clear All Gates</span>
0424     <span class="keyword">elseif</span> strcmp(c,<span class="string">'Clear'</span>)
0425         clist.gate = [] ;
0426         clf;
0427         first_flag = 1;
0428         
0429         <span class="comment">% Gate Cell Files</span>
0430     <span class="keyword">elseif</span> c(1) == <span class="string">'G'</span>
0431         header = <span class="string">'trackOptiView: '</span>;
0432         
0433         trackOptiGateCellFiles(dirname,dirname_cell,CONST, header, clist);
0434         
0435         
0436         <span class="comment">% Gate All XY Positions</span>
0437     <span class="keyword">elseif</span> c(1) == <span class="string">'C'</span>
0438         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0439             
0440             
0441             <span class="keyword">if</span> ~isfield( clist, <span class="string">'gate'</span> );
0442                 clist.gate = [];
0443             <span class="keyword">end</span>
0444             
0445             <span class="keyword">for</span> ll_ = 1:num_xy
0446                 filename = [dirname0,contents_xy(ll_).name,filesep,<span class="string">'clist.mat'</span>];
0447                 
0448                 clist_tmp = gate(load( filename ));
0449                 <span class="keyword">if</span>  ll_ == 1
0450                     clist_comp =clist_tmp;
0451                 <span class="keyword">else</span>
0452                     clist_comp.data = [clist_comp.data; clist_tmp.data];
0453                 <span class="keyword">end</span>
0454             <span class="keyword">end</span>
0455             
0456             save( [dirname0,<span class="string">'clist_comp.mat'</span>], <span class="string">'-STRUCT'</span>, <span class="string">'clist_comp'</span> );
0457             
0458         <span class="keyword">else</span>
0459             disp(<span class="string">'Not supported'</span>);
0460         <span class="keyword">end</span>
0461         
0462         
0463         <span class="comment">% Show Cell Numbers</span>
0464     <span class="keyword">elseif</span> c(1) == <span class="string">'t'</span>
0465         FLAGS.t_flag = ~FLAGS.t_flag;
0466         
0467         <span class="comment">% Show Fluorescent Foci Fits</span>
0468     <span class="keyword">elseif</span> c(1) == <span class="string">'s'</span>
0469         FLAGS.s_flag = ~FLAGS.s_flag;
0470         
0471         <span class="comment">% Show Cell Poles</span>
0472     <span class="keyword">elseif</span> c(1) == <span class="string">'p'</span>
0473         FLAGS.p_flag = ~FLAGS.p_flag;
0474         
0475         <span class="comment">% Enter Debugging Mode</span>
0476     <span class="keyword">elseif</span> c(1) == <span class="string">'k'</span>
0477         tmp_axis = axis;
0478         disp(<span class="string">'Type &quot;return&quot; to exit debugging mode'</span>)
0479         keyboard
0480         resetFlag = true;
0481         clf;
0482         axis( tmp_axis );
0483         
0484         <span class="comment">% Make Kymograph Mosaic for All Cells</span>
0485     <span class="keyword">elseif</span> c(1) == <span class="string">'K'</span>
0486         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0487             tmp_axis = axis;
0488             clf;
0489             <a href="makeKymoMosaic.html" class="code" title="function makeKymoMosaic( dirname, CONST );">makeKymoMosaic</a>( [dirname_cell], CONST );
0490             
0491             disp(<span class="string">'press enter to continue.'</span>);
0492             pause;
0493             axis(tmp_axis);
0494         <span class="keyword">else</span>
0495             disp( <span class="string">'Not supported in this mode.'</span> );
0496         <span class="keyword">end</span>
0497         
0498         <span class="comment">% Show Cell Towers for All Cells</span>
0499     <span class="keyword">elseif</span> c(1) == <span class="string">'Z'</span>
0500         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0501             tmp_axis = axis;
0502             clf;
0503             
0504             
0505             <span class="keyword">if</span> numel(c) &gt; 1
0506                 ll_ = floor(str2num(c(2:end)));
0507             <span class="keyword">else</span>
0508                 ll_ = [];
0509             <span class="keyword">end</span>
0510             
0511             <a href="makeFrameStripeMosaic.html" class="code" title="function [imTot] = makeFrameStripeMosaic( dirName, CONST, ll_, disp_flag )">makeFrameStripeMosaic</a>( [dirname_cell], CONST, ll_,true );
0512             axis equal
0513             
0514             disp(<span class="string">'press enter to continue.'</span>);
0515             pause;
0516             axis(tmp_axis);
0517         <span class="keyword">else</span>
0518             disp( <span class="string">'Not supported in this mode.'</span> );
0519         <span class="keyword">end</span>
0520         
0521         <span class="comment">% Show Consensus for this XY if exists or Calculate new one</span>
0522     <span class="keyword">elseif</span> c(1) == <span class="string">'o'</span>
0523         
0524         <a href="#_sub11" class="code" title="subfunction intCons(dirname0, contents_xy, dircons, setHeader, CONST)">intCons</a>(dirname0, contents_xy(ixy), dircons, setHeader, CONST)<span class="comment">%</span>
0525         
0526         <span class="comment">% Calculate Consensus for all XY</span>
0527     <span class="keyword">elseif</span> c(1) == <span class="string">'Y'</span>
0528         
0529         tmp_axis = axis;
0530         clf;
0531         
0532         
0533         parfor iii = 1:num_xy
0534             
0535             
0536             <span class="keyword">try</span>
0537                 <a href="#_sub11" class="code" title="subfunction intCons(dirname0, contents_xy, dircons, setHeader, CONST)">intCons</a>(dirname0, contents_xy(iii), dircons, setHeader, CONST)
0538             <span class="keyword">catch</span>
0539                 disp( [<span class="string">'Failed on: '</span>, contents_xy(iii).name] );
0540             <span class="keyword">end</span>
0541             
0542         <span class="keyword">end</span>
0543         
0544         
0545         FLAGS__.v_flag = 1;
0546         FLAGS__.m_flag = 0;
0547         FLAGS__.t_flag = 1;
0548         FLAGS__.T_flag = 0;
0549         FLAGS__.ID_flag = 1;
0550         FLAGS__.P_flag = 1;
0551         FLAGS__.e_flag = 0;
0552         FLAGS__.f_flag = 1;
0553         FLAGS__.s_flag = 1;
0554         FLAGS__.p_flag = 0;
0555         FLAGS__.c_flag = 1;
0556         FLAGS__.lyse_flag = 0;
0557         FLAGS__.err_flag = 0;
0558         FLAGS__.D_flag = 0;
0559         
0560         <span class="keyword">for</span> iii = 1:num_xy
0561             
0562             <span class="keyword">try</span>
0563                 iii
0564                 nn__ = 10;
0565                 
0566                 <span class="keyword">if</span> isdir([dirname0,contents_xy(iii).name,filesep,<span class="string">'seg_full'</span>])
0567                     dirname__ = [dirname0,contents_xy(iii).name,filesep,<span class="string">'seg_full'</span>,filesep];
0568                 <span class="keyword">else</span>
0569                     dirname__ = [dirname0,contents_xy(iii).name,filesep,<span class="string">'seg'</span>,filesep];
0570                 <span class="keyword">end</span>
0571                 
0572                 dirname_cell__ = [dirname0,contents_xy(iii).name,filesep,<span class="string">'cell'</span>,filesep];
0573                 dirname_xy__ = [dirname0,contents_xy(iii).name,filesep];
0574                 
0575                 ixy__ = <a href="#_sub4" class="code" title="subfunction ixy = intGetNum( str_xy )">intGetNum</a>( contents_xy(iii).name );
0576                 header__ = [<span class="string">'xy'</span>,num2str(ixy),<span class="string">': '</span>];
0577                 
0578                 contents__=dir([dirname__, file_filter]);
0579                 error_list = [];
0580                 
0581                 clist__ = load([dirname0,contents_xy(iii).name,filesep,<span class="string">'clist.mat'</span>]);
0582                 nameInfo__ = <a href="#_sub2" class="code" title="subfunction [nameInfo] = getDirStruct( dirname )">getDirStruct</a>( dirname0 );
0583                 
0584                 [data_r__, data_c__, data_f__] = <a href="#_sub5" class="code" title="subfunction [data_r, data_c, data_f] = intLoadData( dirname, ">intLoadData</a>( dirname__, <span class="keyword">...</span>
0585                     D_FLAG, contents__, nn__, num_im, nameInfo__, clist__, iii);
0586                 
0587                 
0588                 
0589                 im_tmp = <a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>( data_c__, data_r__, data_f__, FLAGS__, clist__, CONST);
0590                 imwrite( im_tmp, [dircons, <span class="string">'field_'</span>, setHeader, <span class="string">'_'</span>, num2str(ixy__,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
0591             <span class="keyword">catch</span>
0592                 
0593                 disp([<span class="string">'error with '</span>,num2str(iii)]);
0594             <span class="keyword">end</span>
0595         <span class="keyword">end</span>
0596         
0597         figure(1);
0598         
0599         
0600         axis equal
0601         
0602         
0603         figure(1);
0604         axis(tmp_axis);
0605         
0606         <span class="comment">% Cell Tower for Single Cell</span>
0607     <span class="keyword">elseif</span> c(1) == <span class="string">'h'</span>
0608         
0609         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0610             
0611             <span class="keyword">if</span> numel(c) &gt; 1
0612                 comma_pos = findstr(c,<span class="string">','</span>);
0613                 
0614                 <span class="keyword">if</span> isempty(comma_pos)
0615                     ll_ = floor(str2num(c(2:end)));
0616                     xdim__ = [];
0617                 <span class="keyword">else</span>
0618                     ll_ = floor(str2num(c(2:comma_pos(1))));
0619                     xdim__ = floor(str2num(c(comma_pos(1):end)));
0620                 <span class="keyword">end</span>
0621                 
0622                 padStr = <a href="#_sub3" class="code" title="subfunction padStr = getPadSize( dirname )">getPadSize</a>( dirname_cell );
0623                 
0624                 <span class="keyword">if</span> ~isempty( padStr )
0625                     data_cell = [];
0626                     filename_cell_C = [dirname_cell,<span class="string">'Cell'</span>,num2str(ll_,padStr),<span class="string">'.mat'</span>]
0627                     filename_cell_c = [dirname_cell,<span class="string">'cell'</span>,num2str(ll_,padStr),<span class="string">'.mat'</span>]
0628                     
0629                     <span class="keyword">if</span> exist(filename_cell_C, <span class="string">'file'</span> )
0630                         filename_cell = filename_cell_C;
0631                     <span class="keyword">elseif</span> exist(filename_cell_c, <span class="string">'file'</span> )
0632                         filename_cell = filename_cell_c;
0633                     <span class="keyword">else</span>
0634                         filename_cell = [];
0635                     <span class="keyword">end</span>
0636                     
0637                     <span class="keyword">if</span> isempty( filename_cell )
0638                         disp( [<span class="string">'Files: '</span>,filename_cell_C,<span class="string">' and '</span>,filename_cell_c,<span class="string">' do not exist.'</span>]);
0639                     <span class="keyword">else</span>
0640                         <span class="keyword">try</span>
0641                             data_cell = load( filename_cell );
0642                         <span class="keyword">catch</span>
0643                             disp([<span class="string">'Error loading: '</span>, filename_cell] );
0644                         <span class="keyword">end</span>
0645                         
0646                         <span class="keyword">if</span> ~isempty( data_cell )
0647                             tmp_axis = axis;
0648                             clf;
0649                             im_tmp = <a href="makeFrameMosaic.html" class="code" title="function [im] = makeFrameMosaic( data, CONST, xdim, disp_flag, skip )">makeFrameMosaic</a>(data_cell, CONST, xdim__);
0650                             disp(<span class="string">'Press enter to continue'</span>);
0651                             pause;
0652                             axis(tmp_axis);
0653                         <span class="keyword">end</span>
0654                         
0655                     <span class="keyword">end</span>
0656                 <span class="keyword">end</span>
0657             <span class="keyword">end</span>
0658         <span class="keyword">else</span>
0659             disp( <span class="string">'Not supported in this mode.'</span> );
0660         <span class="keyword">end</span>
0661         
0662         <span class="comment">% Show Kymograph for Single Cell</span>
0663     <span class="keyword">elseif</span> c(1) == <span class="string">'H'</span>
0664         
0665         
0666         <span class="keyword">if</span> D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>
0667             
0668             <span class="keyword">if</span> numel(c) &gt; 1
0669                 ll_ = floor(str2num(c(2:end)));
0670                 
0671                 padStr = <a href="#_sub3" class="code" title="subfunction padStr = getPadSize( dirname )">getPadSize</a>( dirname_cell );
0672                 
0673                 <span class="keyword">if</span> ~isempty( padStr )
0674                     data_cell = [];
0675                     filename_cell_C = [dirname_cell,<span class="string">'Cell'</span>,num2str(ll_,padStr),<span class="string">'.mat'</span>]
0676                     filename_cell_c = [dirname_cell,<span class="string">'cell'</span>,num2str(ll_,padStr),<span class="string">'.mat'</span>]
0677                     
0678                     <span class="keyword">if</span> exist(filename_cell_C, <span class="string">'file'</span> )
0679                         filename_cell = filename_cell_C;
0680                     <span class="keyword">elseif</span> exist(filename_cell_c, <span class="string">'file'</span> )
0681                         filename_cell = filename_cell_c;
0682                     <span class="keyword">else</span>
0683                         filename_cell = [];
0684                     <span class="keyword">end</span>
0685                     
0686                     <span class="keyword">if</span> isempty( filename_cell )
0687                         disp( [<span class="string">'Files: '</span>,filename_cell_C,<span class="string">' and '</span>,filename_cell_c,<span class="string">' do not exist.'</span>]);
0688                     <span class="keyword">else</span>
0689                         <span class="keyword">try</span>
0690                             data_cell = load( filename_cell );
0691                         <span class="keyword">catch</span>
0692                             disp([<span class="string">'Error loading: '</span>, filename_cell] );
0693                         <span class="keyword">end</span>
0694                         
0695                         <span class="keyword">if</span> ~isempty( data_cell )
0696                             tmp_axis = axis;
0697                             clf;
0698                             <a href="makeKymographC.html" class="code" title="function [Kymo,ll1,f1mm,f2mm] = makeKymographC( data, disp_flag, CONST );">makeKymographC</a>(data_cell, 1, CONST );
0699                             ylabel(<span class="string">'Long Axis (pixels)'</span>);
0700                             xlabel(<span class="string">'Time (frames)'</span> );
0701                             disp(<span class="string">'Press enter to continue'</span>);
0702                             pause;
0703                             axis(tmp_axis);
0704                         <span class="keyword">end</span>
0705                         
0706                     <span class="keyword">end</span>
0707                 <span class="keyword">end</span>
0708             <span class="keyword">end</span>
0709         <span class="keyword">else</span>
0710             disp( <span class="string">'Not supported in this mode.'</span> );
0711         <span class="keyword">end</span>
0712         
0713         <span class="comment">% Make Time-Lapse Images for Movies</span>
0714     <span class="keyword">elseif</span> strcmp(c,<span class="string">'Movie'</span>)
0715         setAxis = axis;
0716         nn_old = nn;
0717         
0718         z_pad = ceil(log(num_im)/log(10));
0719         
0720         movdir = <span class="string">'mov'</span>;
0721         <span class="keyword">if</span> ~exist( movdir, <span class="string">'dir'</span> )
0722             mkdir( movdir );
0723         <span class="keyword">end</span>
0724         file_tmp = [<span class="string">'%0'</span>,num2str(z_pad),<span class="string">'d'</span>];
0725         
0726         <span class="keyword">for</span> nn = 1:num_im
0727             
0728             [data_r, data_c, data_f] = <a href="#_sub5" class="code" title="subfunction [data_r, data_c, data_f] = intLoadData( dirname, ">intLoadData</a>( dirname, <span class="keyword">...</span>
0729                 D_FLAG, contents, nn, num_im, nameInfo, clist, dirnum);
0730             
0731             <span class="comment">%clf;</span>
0732             tmp_im = <a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>( data_c,data_r, data_f, FLAGS, clist, CONST);
0733             <span class="comment">%axis(setAxis);</span>
0734             
0735             drawnow;
0736             disp( [<span class="string">'Frame number: '</span>, num2str(nn)] );
0737             
0738             <span class="comment">%tmp_im = frame2im(getframe);</span>
0739             imwrite( tmp_im, [movdir,filesep,<span class="string">'mov'</span>,sprintf(file_tmp,nn),<span class="string">'.tif'</span>], <span class="string">'TIFF'</span>, <span class="string">'Compression'</span>, <span class="string">'none'</span> );
0740             
0741         <span class="keyword">end</span>
0742         nn = nn_old;
0743         resetFlag = true;
0744         
0745         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0746         <span class="comment">%</span>
0747         <span class="comment">% Developer Tools (use at own risk)</span>
0748         <span class="comment">%</span>
0749         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0750         
0751         <span class="comment">% Show Error List</span>
0752     <span class="keyword">elseif</span> c(1) == <span class="string">'e'</span>
0753         FLAGS.e_flag = ~FLAGS.e_flag;
0754         
0755         <span class="comment">% Toggle between cell view and region view</span>
0756     <span class="keyword">elseif</span> c(1) == <span class="string">'v'</span>
0757         
0758         FLAGS.v_flag = ~FLAGS.v_flag;
0759         
0760         
0761         <span class="comment">% Edit Segments</span>
0762     <span class="keyword">elseif</span> strcmp(c,<span class="string">'editSegs'</span>)
0763         segsTLEdit( dirname, nn);
0764         
0765         <span class="comment">% Re-Link</span>
0766     <span class="keyword">elseif</span> strcmp(c, <span class="string">'relink'</span>)
0767         
0768         <span class="keyword">if</span> ispc
0769             eval([<span class="string">'!del '</span>,dirname_cell,<span class="string">'*.mat'</span>      ]);
0770             eval([<span class="string">'!del '</span>,dirname,     <span class="string">'*trk.mat*'</span>  ]);
0771             eval([<span class="string">'!del '</span>,dirname,     <span class="string">'*err.mat*'</span>  ]);
0772             eval([<span class="string">'!del '</span>,dirname,     <span class="string">'.trackOpti*'</span>]);
0773             eval([<span class="string">'!del '</span>,dirname_xy,  <span class="string">'clist.mat'</span>  ]);
0774         <span class="keyword">else</span>
0775             eval([<span class="string">'!\rm '</span>,dirname_cell,<span class="string">'*.mat'</span>      ]);
0776             eval([<span class="string">'!\rm '</span>,dirname,     <span class="string">'*trk.mat*'</span>  ]);
0777             eval([<span class="string">'!\rm '</span>,dirname,     <span class="string">'*err.mat*'</span>  ]);
0778             eval([<span class="string">'!\rm '</span>,dirname,     <span class="string">'.trackOpti*'</span>]);
0779             eval([<span class="string">'!\rm '</span>,dirname_xy,  <span class="string">'clist.mat'</span>  ]);
0780         <span class="keyword">end</span>
0781         
0782         <span class="comment">% Re-Run trackOpti</span>
0783         skip = 1;
0784         CLEAN_FLAG = false;
0785         header = <span class="string">'trackOptiView: '</span>;
0786         trackOpti(dirname_xy,skip,CONST, CLEAN_FLAG, header);
0787         
0788     <span class="keyword">elseif</span> c(1) == <span class="string">'n'</span>;
0789         
0790         <span class="keyword">if</span> FLAGS.T_flag
0791             disp( <span class="string">'Tight flag must be off'</span>);
0792         <span class="keyword">else</span>
0793             
0794             x = floor(ginput(1));
0795             
0796             <span class="keyword">if</span> ~isempty(x)
0797                 ii = data_c.regs.regs_label(x(2),x(1));
0798                 tmp_axis = axis();
0799                 
0800                 
0801                 <span class="keyword">if</span> ~ii
0802                     disp(<span class="string">'missed region'</span>);
0803                 <span class="keyword">else</span>
0804                     
0805                     <span class="keyword">if</span> isfield( data_c.regs, <span class="string">'ignoreError'</span> )
0806                         disp([<span class="string">'Picked region '</span>,num2str(ii)]);
0807                         
0808                         
0809                         data_c.regs.ignoreError(ii) = 1;
0810                         
0811                         save([dirname,contents(nn  ).name],<span class="string">'-STRUCT'</span>,<span class="string">'data_c'</span>);
0812                     <span class="keyword">else</span>
0813                         
0814                         disp( <span class="string">'Ignore error not implemented for your version of trackOpti.'</span>);
0815                         
0816                     <span class="keyword">end</span>
0817                 <span class="keyword">end</span>
0818             <span class="keyword">end</span>
0819             
0820         <span class="keyword">end</span>
0821         
0822         <span class="comment">% Reset Linking in Current Frame</span>
0823     <span class="keyword">elseif</span> strcmp(c,<span class="string">'link'</span>);
0824         
0825         <span class="keyword">if</span> FLAGS.T_flag
0826             disp( <span class="string">'Tight flag must be off'</span>);
0827         <span class="keyword">else</span>
0828             
0829             
0830             disp(<span class="string">'pick region to reset linking in the current frame'</span>);
0831             
0832             x = floor(ginput(1));
0833             
0834             <span class="keyword">if</span> ~isempty(x)
0835                 ii = data_c.regs.regs_label(x(2),x(1));
0836                 tmp_axis = axis();
0837                 
0838                 
0839                 <span class="keyword">if</span> ~ii
0840                     disp(<span class="string">'missed region'</span>);
0841                 <span class="keyword">else</span>
0842                     disp([<span class="string">'Picked region '</span>,num2str(ii)]);
0843                     <a href="showDA4new.html" class="code" title="function im = showDA4new( data, data_r, data_f, FLAGS, clist, CONST)">showDA4new</a>( data_f,data_c, data_f, FLAGS, clist, CONST);
0844                     axis( tmp_axis );
0845                     
0846                     disp( <span class="string">'Click on linked cell(s). press enter to return'</span>);
0847                     x = floor(ginput());
0848                     
0849                     ss = size(x);
0850                     
0851                     list_of_regs = [];
0852                     
0853                     <span class="keyword">for</span> hh = 1:ss(1);
0854                         
0855                         jj = data_f.regs.regs_label(x(hh,2),x(hh,1));
0856                         <span class="keyword">if</span> jj
0857                             list_of_regs = [list_of_regs, jj];
0858                         <span class="keyword">end</span>
0859                     <span class="keyword">end</span>
0860                     
0861                     <span class="keyword">if</span> ~isempty(list_of_regs)
0862                         
0863                         <span class="comment">%list_of_regs</span>
0864                         
0865                         
0866                         data_c.regs.ol.f{ii}    = zeros(2, 5);
0867                         
0868                         nnn = min([5,numel(list_of_regs)]);
0869                         
0870                         data_c.regs.ol.f{ii}(1,1:nnn) = 1;
0871                         data_c.regs.ol.f{ii}(2,1:nnn) = list_of_regs(1:nnn);
0872                         data_c.regs.map.f{ii}   = list_of_regs;
0873                         data_c.regs.error.f(ii) = double(numel(list_of_regs)&gt;1);
0874                         data_c.regs.ignoreError(ii) = 1;
0875                         
0876                         <span class="keyword">for</span> kk = list_of_regs
0877                             
0878                             data_f.regs.ol.r{kk}     = zeros(2,5);
0879                             
0880                             data_f.regs.ol.r{kk}(1,1)= 1/numel(list_of_regs);
0881                             data_f.regs.ol.r{kk}(2,1)= ii;
0882                             
0883                             data_f.regs.dA.r(kk)     = 1/numel(list_of_regs);
0884                             data_f.regs.map.r{kk}    = ii;
0885                             data_f.regs.error.r(kk)  = double(numel(list_of_regs)&gt;1);
0886                             data_f.regs.ignoreError(kk) = 1;
0887                         <span class="keyword">end</span>
0888                         
0889                         <span class="comment">% Save files....</span>
0890                         
0891                         save([dirname,contents(nn  ).name],<span class="string">'-STRUCT'</span>,<span class="string">'data_c'</span>);
0892                         save([dirname,contents(nn+1).name],<span class="string">'-STRUCT'</span>,<span class="string">'data_f'</span>);
0893                         
0894                     <span class="keyword">end</span>
0895                 <span class="keyword">end</span>
0896             <span class="keyword">end</span>
0897         <span class="keyword">end</span>
0898         
0899         
0900         <span class="comment">% ReRun Error Resolution</span>
0901     <span class="keyword">elseif</span> strcmp(c,<span class="string">'errRez'</span>);
0902         <span class="comment">% Re-run ErRes and linking code trackOpti</span>
0903         ctmp = input(<span class="string">'Are you sure? (y/n): '</span>,<span class="string">'s'</span>);
0904         
0905         <span class="keyword">if</span> ismember(ctmp(1),<span class="string">'yY'</span>)
0906             <span class="comment">% Erase all stamp files after .trackOptiSetEr.mat</span>
0907             contents_stamp = dir( [dirname,filesep,<span class="string">'.trackOpti*'</span>] );
0908             num_stamp = numel( contents_stamp );
0909             
0910             <span class="keyword">for</span> iii = 1:num_stamp
0911                 
0912                 <span class="keyword">if</span> isempty( strfind( contents_stamp(iii).name,<span class="keyword">...</span>
0913                         <span class="string">'.trackOptiLink.mat'</span>  ) ) &amp;&amp; <span class="keyword">...</span>
0914                         isempty( strfind( contents_stamp(iii).name,<span class="keyword">...</span>
0915                         <span class="string">'.trackOptiErRes1.mat'</span>) ) &amp;&amp; <span class="keyword">...</span>
0916                         isempty( strfind( contents_stamp(iii).name,<span class="keyword">...</span>
0917                         <span class="string">'.trackOptiSetEr.mat'</span> ) )
0918                     <span class="keyword">if</span> ispc
0919                         eval([<span class="string">'!del '</span>,dirname,filesep,<span class="keyword">...</span>
0920                             contents_stamp(iii).name]);
0921                     <span class="keyword">else</span>
0922                         eval([<span class="string">'!\rm '</span>,dirname,filesep,<span class="keyword">...</span>
0923                             contents_stamp(iii).name]);
0924                     <span class="keyword">end</span>
0925                     
0926                 <span class="keyword">end</span>
0927             <span class="keyword">end</span>
0928             
0929             <span class="keyword">if</span> ispc
0930                 eval([<span class="string">'!del '</span>,dirname_cell,<span class="string">'*.mat'</span>]);
0931                 eval([<span class="string">'!del '</span>,dirname_xy,<span class="string">'clist.mat'</span>]);
0932             <span class="keyword">else</span>
0933                 eval([<span class="string">'!\rm '</span>,dirname_cell,<span class="string">'*.mat'</span>]);
0934                 eval([<span class="string">'!\rm '</span>,dirname_xy,<span class="string">'clist.mat'</span>]);
0935             <span class="keyword">end</span>
0936             
0937             <span class="comment">% Re-Run trackOpti</span>
0938             skip = 1;
0939             CLEAN_FLAG = false;
0940             header = <span class="string">'trackOptiView: '</span>;
0941             trackOpti(dirname_xy,skip,CONST, CLEAN_FLAG, header);
0942             
0943         <span class="keyword">end</span>
0944         
0945     <span class="keyword">else</span>
0946         <span class="comment">% we assume that it is a number for a frame change.</span>
0947         tmp_nn = str2num(c);
0948         <span class="keyword">if</span> ~isempty(tmp_nn)
0949             nn = tmp_nn;
0950             <span class="keyword">if</span> nn &gt; num_im;
0951                 nn = num_im;
0952             <span class="keyword">elseif</span> nn&lt; 1
0953                 nn = 1;
0954             <span class="keyword">end</span>
0955         <span class="keyword">end</span>
0956         resetFlag = true;
0957         
0958     <span class="keyword">end</span>
0959     
0960 <span class="keyword">end</span>
0961 
0962 <span class="keyword">try</span>
0963     save(filename_flags, <span class="string">'FLAGS'</span>, <span class="string">'nn'</span>, <span class="string">'dirnum'</span>, <span class="string">'error_list'</span> );
0964 <span class="keyword">catch</span>
0965     disp(<span class="string">'Error saving flag preferences.'</span>);
0966 <span class="keyword">end</span>
0967 
0968 <span class="keyword">end</span>
0969 
0970 
0971 <span class="comment">% END OF MAIN FUNCTION (trackOptiView)</span>
0972 
0973 
0974 <span class="comment">%% INTERNAL FUNCTIONS</span>
0975 
0976 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0977 <span class="comment">%</span>
0978 <span class="comment">% loaderInternal</span>
0979 <span class="comment">%</span>
0980 <span class="comment">% Load Date and put in outline fields.</span>
0981 <span class="comment">%</span>
0982 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0983 <a name="_sub1" href="#_subfunctions" class="code">function data = loaderInternal( filename, clist )</a>
0984 data = load( filename );
0985 ss = size( data.phase );
0986 
0987 <span class="keyword">if</span> isfield( data, <span class="string">'mask_cell'</span> )
0988     data.outline =  xor(bwmorph( data.mask_cell, <span class="string">'dilate'</span> ), data.mask_cell);
0989 <span class="keyword">end</span>
0990 
0991 
0992 <span class="keyword">if</span> isempty( clist )
0993     
0994 <span class="keyword">else</span>
0995     clist = gate(clist);
0996     
0997     data.cell_outline = false(ss);
0998     
0999     <span class="comment">%tic</span>
1000     <span class="keyword">if</span> isfield( data, <span class="string">'regs'</span> ) &amp;&amp; isfield( data.regs, <span class="string">'ID'</span> )
1001         
1002         ind = find(ismember(data.regs.ID,clist.data(:,1)));
1003         
1004         <span class="comment">%     for ii = ind</span>
1005         <span class="comment">%         [xx,yy] = getBBpad(data.regs.props(ii).BoundingBox,ss,1);</span>
1006         <span class="comment">%</span>
1007         <span class="comment">%         mask_tmp = data.regs.regs_label(yy,xx)==ii;</span>
1008         <span class="comment">%         data.cell_outline(yy,xx) = or( data.cell_outline(yy,xx), ...</span>
1009         <span class="comment">%             xor(bwmorph( mask_tmp, 'dilate' ),...</span>
1010         <span class="comment">%             mask_tmp));</span>
1011         <span class="comment">%     end</span>
1012         
1013         mask_tmp = ismember( data.regs.regs_label, ind );
1014         
1015         data.cell_outline = xor(bwmorph( mask_tmp, <span class="string">'dilate'</span> ), mask_tmp);
1016         
1017     <span class="keyword">end</span>
1018 <span class="keyword">end</span>
1019 <span class="comment">%toc</span>
1020 
1021 <span class="keyword">end</span>
1022 
1023 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1024 <span class="comment">%</span>
1025 <span class="comment">% getDirStruct</span>
1026 <span class="comment">%</span>
1027 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1028 <a name="_sub2" href="#_subfunctions" class="code">function [nameInfo] = getDirStruct( dirname )</a>
1029 
1030 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1031 contents = dir( [dirname,filesep,<span class="string">'*.tif'</span>] );
1032 
1033 nt  = [];
1034 nc  = [];
1035 nxy = [];
1036 nz  = [];
1037 
1038 num_im = numel(contents);
1039 
1040 <span class="keyword">for</span> i = 1:num_im;
1041     nameInfo = ReadFileName( contents(i).name );
1042     
1043     nt  = [nt,  nameInfo.npos(1,1)];
1044     nc  = [nc,  nameInfo.npos(2,1)];
1045     nxy = [nxy, nameInfo.npos(3,1)];
1046     nz  = [nz,  nameInfo.npos(4,1)];
1047 <span class="keyword">end</span>
1048 
1049 nt  = sort(unique(nt));
1050 nc  = sort(unique(nc));
1051 nxy = sort(unique(nxy));
1052 nz  = sort(unique(nz));
1053 
1054 xyPadSize = floor(log(max(nxy))/log(10))+1;
1055 padString = [<span class="string">'%0'</span>,num2str(xyPadSize),<span class="string">'d'</span>];
1056 
1057 num_xy = numel(nxy);
1058 num_c  = numel(nc);
1059 num_z  = numel(nz);
1060 num_t  = numel(nt);
1061 
1062 
1063 nameInfo.nt  = nt;
1064 nameInfo.nc  = nc;
1065 nameInfo.nxy = nxy;
1066 nameInfo.nz  = nz;
1067 
1068 <span class="keyword">end</span>
1069 
1070 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1071 <span class="comment">%</span>
1072 <span class="comment">% getPadSize</span>
1073 <span class="comment">%</span>
1074 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1075 <a name="_sub3" href="#_subfunctions" class="code">function padStr = getPadSize( dirname )</a>
1076 
1077 contents = dir([dirname,<span class="string">'*ell*.mat'</span>]);
1078 
1079 <span class="keyword">if</span> numel(contents) == 0
1080     disp(<span class="string">'No cell files'</span> );
1081     padStr = []
1082 <span class="keyword">else</span>
1083     num_num = sum(ismember(contents(1).name,<span class="string">'1234567890'</span>));
1084     padStr = [<span class="string">'%0'</span>,num2str(num_num),<span class="string">'d'</span>];
1085 <span class="keyword">end</span>
1086 
1087 <span class="keyword">end</span>
1088 
1089 
1090 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1091 <span class="comment">%</span>
1092 <span class="comment">% intGetNum</span>
1093 <span class="comment">%</span>
1094 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1095 <a name="_sub4" href="#_subfunctions" class="code">function ixy = intGetNum( str_xy )</a>
1096 ixy = str2num(str_xy(ismember(str_xy, <span class="string">'0123456789'</span> )));
1097 <span class="keyword">end</span>
1098 
1099 
1100 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1101 <span class="comment">%</span>
1102 <span class="comment">% intLoadData</span>
1103 <span class="comment">%</span>
1104 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1105 <a name="_sub5" href="#_subfunctions" class="code">function [data_r, data_c, data_f] = intLoadData( dirname, </a><span class="keyword">...</span>
1106     D_FLAG, contents, nn, num_im, nameInfo, clist, ixy)
1107 
1108 
1109 <span class="keyword">if</span> (D_FLAG == <a href="#_sub6" class="code" title="subfunction val = AD_FLAG()">AD_FLAG</a>) || (D_FLAG == <a href="#_sub7" class="code" title="subfunction val = SD_FLAG()">SD_FLAG</a>)
1110     
1111     <span class="comment">%'start'</span>
1112     
1113     <span class="keyword">if</span> (nn ==1) &amp;&amp; (1 == num_im)
1114         data_r = [];
1115         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1116         data_f = [];
1117     <span class="keyword">elseif</span> nn == 1;
1118         data_r = [];
1119         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1120         data_f = [];
1121         <span class="comment">%data_f = loaderInternal([dirname,contents(nn+1).name], clist);</span>
1122         <span class="comment">%data_ff= loaderInternal([dirname,contents(nn+2).name]);</span>
1123     <span class="keyword">elseif</span> nn == num_im
1124         <span class="comment">%data_r = loaderInternal([dirname,contents(nn-1).name], clist);</span>
1125         data_r = [];
1126         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1127         data_f = [];
1128         <span class="comment">%data_ff= [];</span>
1129     <span class="keyword">elseif</span> nn == num_im-1
1130         <span class="comment">%data_r = loaderInternal([dirname,contents(nn-1).name], clist);</span>
1131         data_r = [];
1132         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1133         data_f = [];
1134         <span class="comment">%data_f = loaderInternal([dirname,contents(nn+1).name], clist);</span>
1135         <span class="comment">%data_ff= [];</span>
1136     <span class="keyword">else</span>
1137         
1138         <span class="keyword">if</span> 1
1139             data_r = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn-1).name], clist);
1140             data_f = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn+1).name], clist);
1141         <span class="keyword">else</span>
1142             data_r = [];
1143             data_f = [];
1144         <span class="keyword">end</span>
1145         data_c = <a href="#_sub1" class="code" title="subfunction data = loaderInternal( filename, clist )">loaderInternal</a>([dirname,contents(nn  ).name], clist);
1146         <span class="comment">%data_ff= loaderInternal([dirname,contents(nn+1).name]);</span>
1147     <span class="keyword">end</span>
1148     
1149     <span class="comment">%'finish'</span>
1150     
1151 <span class="keyword">else</span>
1152     
1153     data_f = [];
1154     data_r = [];
1155     data_c = [];
1156     
1157     <span class="comment">% it  = nameInfo.npos(1,1);</span>
1158     <span class="comment">% ic  = nameInfo.npos(2,1);</span>
1159     <span class="comment">% ixy = nameInfo.npos(3,1);</span>
1160     <span class="comment">% iz  = nameInfo.npos(4,1);</span>
1161     
1162     nameInfo.npos(1,1) = nameInfo.nt(nn);
1163     nameInfo.npos(3,1) = nameInfo.nxy(ixy);
1164     nameInfo.npos(2,1) = 1;
1165     nameInfo.npos(4,1) = 1;
1166     
1167     name = [dirname,MakeFileName(nameInfo)];
1168     
1169     
1170     data_c.phase = imread(name);
1171     <span class="keyword">for</span> ic = nameInfo.nc(2:end)
1172         
1173         nameInfo.npos(2,1) = nameInfo.nc(ic);
1174         name = [dirname,MakeFileName(nameInfo)];
1175         
1176         tmp = imread(name);
1177         data_c = setfield( data_c, [<span class="string">'fluor'</span>,num2str(ic-1)], tmp );
1178     <span class="keyword">end</span>
1179 <span class="keyword">end</span>
1180 
1181 
1182 
1183 
1184 
1185 <span class="keyword">end</span>
1186 
1187 <span class="comment">% Do directory handling</span>
1188 <span class="comment">% Sense whether trackOptiView is being launched with an align of seg</span>
1189 <span class="comment">% directory.</span>
1190 <a name="_sub6" href="#_subfunctions" class="code">function val = AD_FLAG()</a>
1191 val = 0;
1192 <span class="keyword">end</span>
1193 <a name="_sub7" href="#_subfunctions" class="code">function val = SD_FLAG()</a>
1194 val = 1;
1195 <span class="keyword">end</span>
1196 <a name="_sub8" href="#_subfunctions" class="code">function val = ND_FLAG()</a>
1197 val = 2;
1198 <span class="keyword">end</span>
1199 
1200 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1201 <span class="comment">%</span>
1202 <span class="comment">% intDispError</span>
1203 <span class="comment">%</span>
1204 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1205 <a name="_sub9" href="#_subfunctions" class="code">function intDispError( data_c, FLAGS )</a>
1206 
1207 <span class="keyword">for</span> kk = 1:data_c.regs.num_regs
1208     <span class="keyword">if</span> isfield(data_c,<span class="string">'regs'</span>) &amp;&amp;<span class="keyword">...</span>
1209             isfield(data_c.regs, <span class="string">'error'</span>) &amp;&amp; <span class="keyword">...</span>
1210             isfield(data_c.regs.error,<span class="string">'label'</span>) &amp;&amp; <span class="keyword">...</span>
1211             ~isempty( data_c.regs.error.label{kk} )
1212         <span class="keyword">if</span> FLAGS.v_flag &amp;&amp; isfield( data_c.regs, <span class="string">'ID'</span> )
1213             disp(  [<span class="string">'Cell: '</span>, num2str(data_c.regs.ID(kk)), <span class="string">', '</span>, <span class="keyword">...</span>
1214                 data_c.regs.error.label{kk}] );
1215         <span class="keyword">else</span>
1216             disp(  [ data_c.regs.error.label{kk}] );
1217         <span class="keyword">end</span>
1218     <span class="keyword">end</span>
1219 <span class="keyword">end</span>
1220 <span class="keyword">end</span>
1221 
1222 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1223 <span class="comment">%</span>
1224 <span class="comment">% intSetDefaultFlags</span>
1225 <span class="comment">%</span>
1226 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1227 <a name="_sub10" href="#_subfunctions" class="code">function FLAGS = intSetDefaultFlags()</a>
1228 
1229 FLAGS.v_flag  = 1;
1230 FLAGS.m_flag  = 0;
1231 FLAGS.t_flag  = 0;
1232 FLAGS.T_flag  = 0;
1233 FLAGS.ID_flag = 1;
1234 FLAGS.P_flag  = 1;
1235 FLAGS.e_flag  = 0;
1236 FLAGS.f_flag  = 0;
1237 FLAGS.s_flag  = 1;
1238 FLAGS.p_flag  = 0;
1239 FLAGS.c_flag  = 1;
1240 FLAGS.lyse_flag = false;
1241 FLAGS.err_flag = false;
1242 
1243 <span class="keyword">end</span>
1244 
1245 
1246 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1247 <span class="comment">%</span>
1248 <span class="comment">% intSetDefaultFlags</span>
1249 <span class="comment">%</span>
1250 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
1251 <a name="_sub11" href="#_subfunctions" class="code">function intCons(dirname0, contents_xy, dircons, setHeader, CONST)</a>
1252 <span class="comment">%try</span>
1253 
1254 ixy = <a href="#_sub4" class="code" title="subfunction ixy = intGetNum( str_xy )">intGetNum</a>( contents_xy.name );
1255 header = [<span class="string">'xy'</span>,num2str(ixy),<span class="string">': '</span>];
1256 
1257 <span class="keyword">if</span> exist([dircons, <span class="string">'consColor_'</span>, setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>])
1258     disp(<span class="string">'Consensus Already Calculated'</span>)
1259     imColor = imread([dircons, <span class="string">'consColor_'</span>, setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>]);
1260     figure(1)
1261     clf
1262     imshow(imColor);
1263     disp(<span class="string">'Press any key to continue'</span>)
1264     pause
1265     
1266 <span class="keyword">else</span>
1267     
1268     disp(<span class="string">'No Images Found.'</span>)
1269     disp(<span class="string">'Calculate New Consensus?'</span>)
1270     d = input(<span class="string">'[y/n]:'</span>,<span class="string">'s'</span>);
1271     
1272     <span class="keyword">if</span> strcmp(d,<span class="string">'y'</span>)
1273         
1274         <span class="keyword">if</span> isdir([dirname0,contents_xy.name,filesep,<span class="string">'seg_full'</span>])
1275             dirname = [dirname0,contents_xy.name,filesep,<span class="string">'seg_full'</span>,filesep];
1276         <span class="keyword">end</span>
1277         
1278         dirname_cell = [dirname0,contents_xy.name,filesep,<span class="string">'cell'</span>,filesep];
1279         
1280         disp( [<span class="string">'Doing '</span>,num2str(ixy)] );
1281         
1282         <span class="comment">%makeFrameStripeMosaicCenter( [dirname_cell], CONST, ll_ );</span>
1283         <span class="comment">%[imTot, imColor, imBW, imInv, kymo, kymoMask, I ] = ...</span>
1284         <span class="comment">%    makeFrameStripeMosaicCenterMag( [dirname_cell], CONST, [], 0, 0 );</span>
1285         <span class="comment">%[imTot, imColor, imBW, imInv, kymo, kymoMask, I ] = ...</span>
1286         <span class="comment">%    makeFrameStripeMosaicCenter2( [dirname_cell], CONST, ll_ );</span>
1287         [imTot, imColor, imBW, imInv, kymo, kymoMask, I, jjunk, jjunk, imTot10 ] = <span class="keyword">...</span>
1288             <a href="makeConsIm.html" class="code" title="function [ imMosaic, imColor, imBW, imInv, kymo, kymoMask, I,kymoMax, kymoMaskMax, imMosaic10, imBWunmasked, imBWmask, hotPix,AA, BB ] = makeConsIm( dirName, CONST, skip, mag, disp_flag )">makeConsIm</a>( [dirname_cell], CONST, [], [], false );
1289         
1290         figure(1)
1291         clf
1292         imshow(imColor)
1293         
1294         disp(<span class="string">'Press any key to continue'</span>)
1295         pause
1296         
1297         <span class="keyword">if</span> ~isempty( imTot )
1298             imwrite( imBW,    [dircons, <span class="string">'consBW_'</span>,    setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
1299             imwrite( imColor, [dircons, <span class="string">'consColor_'</span>, setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
1300             imwrite( imInv,   [dircons, <span class="string">'consInv_'</span>,   setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
1301             imwrite( imTot10,   [dircons, <span class="string">'typical_'</span>,   setHeader, <span class="string">'_'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.tif'</span>], <span class="string">'tif'</span> );
1302             
1303             <span class="comment">%figure(99);</span>
1304             <span class="comment">%print( '-depsc', [dircons, 'dyn', num2str(ixy,'%02d'), '.eps'] );</span>
1305             
1306             save( [dircons, <span class="string">'fits'</span>, num2str(ixy,<span class="string">'%02d'</span>), <span class="string">'.mat'</span>], <span class="string">'I'</span> );
1307         <span class="keyword">else</span>
1308             
1309             disp( [<span class="string">'Found no cells in '</span>, dirname_cell, <span class="string">'.'</span>] );
1310         <span class="keyword">end</span>
1311         
1312     <span class="keyword">else</span>
1313         
1314         <span class="keyword">return</span>
1315         
1316     <span class="keyword">end</span>
1317     <span class="comment">%catch</span>
1318     <span class="comment">%disp( ['Error ',num2str(ixy)] );</span>
1319     
1320 <span class="keyword">end</span>
1321 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 23-Feb-2016 13:44:44 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>